"use strict";var ganttChart=function(t){function e(t){var e=B.call(t);return e!==C&&e!==M&&A("Expected object or array. Got: "+e),e===C?O.items=O.items.concat(t):O.items.push(t),v(),I}function n(t){return arguments.length?(d3.select(window).on("resize",t!==!1?y:null),O.isAutoResize=t,I):O.isAutoResize}function a(){var t=O.lanes.length,e=h(),n=g();k=d3.select(O.renderTo).append("svg").attr("width",O.width).attr("height",O.height).attr("class","gantt-chart"),k.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",n),N=d3.behavior.drag().on("dragstart",l).on("drag",r).on("dragend",i),Y=k.append("g").attr("transform","translate("+O.margin.left+","+O.margin.top+")").attr("width",e).attr("height",n).attr("class","main"),D=Y.append("g").attr("clip-path","url(#clip)"),P=d3.select("body").append("div").attr("class","gantt-tooltip").style("opacity",0),X=d3.time.scale().domain(p()).range([0,e]),Z=d3.scale.linear().domain([0,t]).range([0,n]),R=d3.svg.axis().scale(X).orient("bottom").ticks(5),j=d3.svg.axis().scale(Z).orient("left").ticks(t).tickFormat(""),F=d3.behavior.zoom().x(X),Y.append("g").attr("transform","translate(0,"+n+")").attr("class","main axis date").call(R),Y.append("g").attr("class","main axis lane").call(j),Y.append("g").attr("class","laneLabels"),k.call(F),d3.select("html").on("click",function(t){O.isEnableTooltip&&(event.target.closest("svg rect")||f())})}function r(){d3.select(this).attr("x",d3.event.x).attr("y",d3.event.y)}function i(t){var e=d3.select(this),n=Math.round(Z.invert(e.attr("y"))),a=e.attr("x");n>=O.lanes.length&&(n=O.lanes.length-1),0>n&&(n=0),e.attr("y",Z(n)),t.lane=n,t.start=Date.parse(X.invert(a)),t.end=Date.parse(X.invert(parseFloat(e.attr("width"))+parseFloat(a)))}function l(){d3.event.sourceEvent.stopPropagation()}function s(t,e){var n;for(n in e)t.hasOwnProperty(n)&&(B.call(e[n])===M?s(t[n],e[n]):t[n]=e[n])}function o(t){return arguments.length?(N.on("dragstart",t?l:null).on("drag",t?r:null).on("dragend",t?i:null),O.isEnableDrag=t,I):O.isEnableDrag}function c(t){return arguments.length?(O.isEnableTooltip=t,x(),I):O.isEnableTooltip}function u(t){return arguments.length?(F.on("zoom",t?x:null),O.isEnableZoom=t,I):O.isEnableZoom}function d(){return d3.max(O.items,function(t){return t.lane})+1||0}function h(){return O.width-O.margin.right-O.margin.left}function g(){return O.height-O.margin.top-O.margin.bottom}function p(){return[d3.min(O.items,function(t){return t.start}),d3.max(O.items,function(t){return t.end})]}function f(){P.transition().duration(500).style("opacity",0).style("display","none")}function m(t){var e=B.call(t);return arguments.length?(e!==C&&A("Expected array. Got: "+e),O.items=t,v(),I):O.items}function b(t){var e=B.call(t);return arguments.length?(e!==C&&A("Expected array. Got: "+e),O.lanes=t,O.lanes.length=d()||O.lanes.length,T(!O.isShowLaneLabel),T(!O.isShowLaneLabel),I):O.lanes}function w(t){var e=" margin value is incorrect. All values should be numbers";return arguments.length?(void 0!==t.top&&(isNaN(t.top)&&A("'Top'"+e),O.margin.top=parseInt(t.top),Y.attr("transform","translate("+O.margin.left+","+O.margin.top+")")),void 0!==t.right&&(isNaN(t.right)&&A("'Right'"+e),O.margin.right=parseInt(t.right)),void 0!==t.bottom&&(isNaN(t.bottom)&&A("'Bottom'"+e),O.margin.bottom=parseInt(t.bottom)),void 0!==t.left&&(isNaN(t.left)&&A("'Left'"+e),O.margin.left=parseInt(t.left),Y.attr("transform","translate("+O.margin.left+","+O.margin.top+")")),y(),I):O.margin}function v(){var t=d();O.lanes.length=t,X.domain(p()),j.ticks(t),Z.domain([0,t]),F.x(X),x()}function x(){var t,e=g()/(O.lanes.length||1)/(O.sublanes||1);t=D.selectAll("rect").data(O.items,function(t){return t.id}).attr("x",function(t){return X(t.start)}).attr("y",function(t){return O.sublanes<2?Z(t.lane):Z(t.lane)+t.sublane*e}).attr("width",function(t){return X(t.end)-X(t.start)}).attr("height",function(t){return e}).call(N).on("click",O.isEnableTooltip?E:null),t.enter().append("rect").attr("class",function(t){return t["class"]+" main"}).attr("x",function(t){return X(t.start)}).attr("y",function(t){return O.sublanes<2?Z(t.lane):Z(t.lane)+t.sublane*e}).attr("width",function(t){return X(t.end)-X(t.start)}).attr("height",function(t){return e}).attr("opacity",.75).call(N).on("click",O.isEnableTooltip?E:null),t.exit().remove(),Y.select("g.main.axis.date").call(R),Y.select("g.main.axis.lane").call(j),f()}function y(){O.isAutoResize&&(O.width=parseInt(d3.select(O.renderTo).style("width")),O.height=parseInt(d3.select(O.renderTo).style("height")));var t=h(),e=g();X.range([0,t]),Z.range([0,e]),k.attr("width",O.width),k.attr("height",O.height),k.select("defs").select("clipPath").select("rect").attr("width",t),k.select("defs").select("clipPath").select("rect").attr("height",t),Y.attr("width",t),Y.attr("height",e),Y.select("g.main.axis.date").attr("transform","translate(0,"+g()+")"),Y.select("g.laneLabels").selectAll(".laneText").data(O.lanes).attr("y",function(t,e){return Z(e+.5)}),F.x(X),S(O.isShowYGrid),L(O.isShowYGrid),x()}function T(t){return arguments.length?(O.isShowLaneLabel=t,t===!1?Y.selectAll(".laneText").remove():Y.select("g.laneLabels").selectAll(".laneText").data(O.lanes).enter().append("text").text(function(t){return t}).attr("x",-O.margin.right).attr("y",function(t,e){return Z(e+.5)}).attr("dy",".5ex").attr("text-anchor","start").attr("class","laneText"),I):O.isShowLaneLabel}function E(t){d3.event.defaultPrevented||(P.style("display","block").transition().duration(200).style("opacity",.9),P.html("function"==typeof t.tooltip?t.tooltip():t.tooltip).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"))}function S(t){if(!arguments.length)return O.isShowXGrid;var e=t!==!1?-g():-6;return R.tickSize(e,0,0),O.isShowXGrid=t,Y.select("g.main.axis.date").call(R),I}function L(t){if(!arguments.length)return O.isShowYGrid;var e=t!==!1?-h():-6;return j.tickSize(e,0,0),O.isShowYGrid=t,Y.select("g.main.axis.lane").call(j),I}function G(t,e){return arguments.length?(O.width=parseInt(t)||O.width,O.height=parseInt(e)||O.height,n(!1),y(),I):[O.width,O.height]}function z(t){return arguments.length?(O.sublanes=t,x(),I):O.sublanes}function A(t){throw TypeError(t)}var I,k,N,Y,D,P,R,X,j,Z,F,O={},B=Object.prototype.toString,C="[object Array]",M="[object Object]";return I={addItems:e,autoresize:n,enableDrag:o,enableTooltip:c,enableZoom:u,chart:function(){return Y},drag:function(){return N},items:m,lanes:b,margin:w,showLaneLabel:T,showXGrid:S,showYGrid:L,size:G,sublanes:z,svg:function(){return k},redraw:x,renderTo:function(){return O.renderTo},resize:y,xAxis:function(){return R},xScale:function(){return X},yScale:function(){return Z},yAxis:function(){return j},zoom:function(){return F}},O.items=null,O.lanes=null,O.renderTo="#gantt_chart",O.sublanes=1,O.isAutoResize=!0,O.isEnableDrag=!0,O.isEnableTooltip=!0,O.isEnableZoom=!0,O.isShowXGrid=!0,O.isShowYGrid=!0,O.isShowLaneLabel=!0,O.height=null,O.width=null,O.margin={top:20,right:15,bottom:20,left:20},function(){s(O,t),O.items=O.items||[],O.lanes=O.lanes||[],O.lanes.length=d(),null===O.height&&(O.height=parseInt(d3.select(O.renderTo).style("height"))||480),null===O.width&&(O.width=parseInt(d3.select(O.renderTo).style("width"))||640),a(),n(O.isAutoResize),o(O.isEnableDrag),c(O.isEnableTooltip),u(O.isEnableZoom),T(O.isEnableTooltip),S(O.isShowXGrid),L(O.isShowYGrid),x()}(),I};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbnR0LWNoYXJ0LmpzIl0sIm5hbWVzIjpbImdhbnR0Q2hhcnQiLCJjb25mIiwiYWRkSXRlbXMiLCJuZXdJdGVtcyIsIml0ZW1zVHlwZSIsInRvU3RyIiwiY2FsbCIsImFzdHIiLCJvc3RyIiwidGhyb3dFcnJvciIsInNlbGYiLCJpdGVtcyIsImNvbmNhdCIsInB1c2giLCJvbkl0ZW1zQ2hhbmdlIiwiYXBpIiwiYXV0b3Jlc2l6ZSIsImlzQXV0b1Jlc2l6ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsImQzIiwic2VsZWN0Iiwid2luZG93Iiwib24iLCJyZXNpemUiLCJidWlsZCIsImxhbmVMZW5ndGgiLCJsYW5lcyIsIm1hcmdpbldpZHRoIiwiZ2V0TWFyZ2luV2lkdGgiLCJtYXJnaW5IZWlnaHQiLCJnZXRNYXJnaW5IZWlnaHQiLCJjaGFydCIsInJlbmRlclRvIiwiYXBwZW5kIiwiYXR0ciIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhZyIsImJlaGF2aW9yIiwiZHJhZ3N0YXJ0IiwiZHJhZ21vdmUiLCJkcmFnZW5kIiwibWFpbiIsIm1hcmdpbiIsImxlZnQiLCJ0b3AiLCJpdGVtUmVjdHMiLCJ0b29sdGlwRGl2Iiwic3R5bGUiLCJ4U2NhbGUiLCJ0aW1lIiwic2NhbGUiLCJkb21haW4iLCJnZXRUaW1lRG9tYWluIiwicmFuZ2UiLCJ5U2NhbGUiLCJsaW5lYXIiLCJ4QXhpcyIsInN2ZyIsImF4aXMiLCJvcmllbnQiLCJ0aWNrcyIsInlBeGlzIiwidGlja0Zvcm1hdCIsInpvb20iLCJ4IiwiZCIsImlzRW5hYmxlVG9vbHRpcCIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImhpZGVUb29sdGlwIiwidGhpcyIsInkiLCJlbCIsImxhbmUiLCJNYXRoIiwicm91bmQiLCJpbnZlcnQiLCJzdGFydCIsIkRhdGUiLCJwYXJzZSIsImVuZCIsInBhcnNlRmxvYXQiLCJzb3VyY2VFdmVudCIsInN0b3BQcm9wYWdhdGlvbiIsImNvcHlTYW1lUHJvcCIsImNvcHlUbyIsImNvcHlGcm9tIiwicCIsImhhc093blByb3BlcnR5IiwiZW5hYmxlRHJhZyIsImlzRW5hYmxlRHJhZyIsImVuYWJsZVRvb2x0aXAiLCJyZWRyYXciLCJlbmFibGVab29tIiwiaXNFbmFibGVab29tIiwiZ2V0TGFuZUxlbmd0aCIsIm1heCIsInJpZ2h0IiwiYm90dG9tIiwibWluIiwidHJhbnNpdGlvbiIsImR1cmF0aW9uIiwibmV3TGFuZXMiLCJsYW5lc1R5cGUiLCJzaG93TGFuZUxhYmVsIiwiaXNTaG93TGFuZUxhYmVsIiwibmV3TWFyZ2luIiwibXNnIiwidW5kZWZpbmVkIiwiaXNOYU4iLCJwYXJzZUludCIsInJlY3RzIiwiaXRlbUhlaWdodCIsInN1YmxhbmVzIiwic2VsZWN0QWxsIiwiZGF0YSIsImlkIiwic3VibGFuZSIsInNob3dUb29sdGlwIiwiZW50ZXIiLCJleGl0IiwicmVtb3ZlIiwiaSIsInNob3dYR3JpZCIsImlzU2hvd1lHcmlkIiwic2hvd1lHcmlkIiwidGV4dCIsImRlZmF1bHRQcmV2ZW50ZWQiLCJodG1sIiwidG9vbHRpcCIsImlzU2hvd1hHcmlkIiwidGlja1NpemUiLCJzaXplIiwibmV3U3VibGFuZXMiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFJQSxZQUFhLFNBQVNDLEdBOEV0QixRQUFTQyxHQUFTQyxHQUNkLEdBQUlDLEdBQVlDLEVBQU1DLEtBQUtILEVBSTNCLE9BSElDLEtBQWNHLEdBQVFILElBQWNJLEdBQU1DLEVBQVcsa0NBQW9DTCxHQUM1RkEsSUFBY0csRUFBUUcsRUFBS0MsTUFBUUQsRUFBS0MsTUFBTUMsT0FBT1QsR0FBWU8sRUFBS0MsTUFBTUUsS0FBS1YsR0FDbEZXLElBQ09DLEVBR1gsUUFBU0MsR0FBV0MsR0FDaEIsTUFBS0MsV0FBVUMsUUFDZkMsR0FBR0MsT0FBT0MsUUFBUUMsR0FBRyxTQUFXTixLQUFpQixFQUFTTyxFQUFTLE1BQ25FZCxFQUFLTyxhQUFlQSxFQUNiRixH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aEYiLCJmaWxlIjoiZ2FudHQtY2hhcnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FudHRDaGFydCA9IGZ1bmN0aW9uKGNvbmYpIHtcbiAgICB2YXIgYXBpLFxuICAgICAgICBzZWxmID0ge30sXG4gICAgICAgIHRvU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcbiAgICAgICAgYXN0ciA9IFwiW29iamVjdCBBcnJheV1cIixcbiAgICAgICAgb3N0ciA9IFwiW29iamVjdCBPYmplY3RdXCIsXG4gICAgICAgIGNoYXJ0LCBkcmFnLCBtYWluLCBpdGVtUmVjdHMsIHRvb2x0aXBEaXYsIHhBeGlzLCB4U2NhbGUsIHlBeGlzLCB5U2NhbGUsIHpvb207XG5cbiAgICBhcGkgPSB7XG4gICAgICAgIGFkZEl0ZW1zOiBhZGRJdGVtcyxcbiAgICAgICAgYXV0b3Jlc2l6ZTogYXV0b3Jlc2l6ZSxcbiAgICAgICAgZW5hYmxlRHJhZzogZW5hYmxlRHJhZyxcbiAgICAgICAgZW5hYmxlVG9vbHRpcDogZW5hYmxlVG9vbHRpcCxcbiAgICAgICAgZW5hYmxlWm9vbTogZW5hYmxlWm9vbSxcbiAgICAgICAgY2hhcnQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbWFpbiB9LFxuICAgICAgICBkcmFnOiBmdW5jdGlvbigpIHsgcmV0dXJuIGRyYWcgfSxcbiAgICAgICAgaXRlbXM6IGl0ZW1zLFxuICAgICAgICBsYW5lczogbGFuZXMsXG4gICAgICAgIG1hcmdpbjogbWFyZ2luLFxuICAgICAgICBzaG93TGFuZUxhYmVsOiBzaG93TGFuZUxhYmVsLFxuICAgICAgICBzaG93WEdyaWQ6IHNob3dYR3JpZCxcbiAgICAgICAgc2hvd1lHcmlkOiBzaG93WUdyaWQsXG4gICAgICAgIHNpemU6IHNpemUsXG4gICAgICAgIHN1YmxhbmVzOiBzdWJsYW5lcyxcbiAgICAgICAgc3ZnOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNoYXJ0IH0sXG4gICAgICAgIHJlZHJhdzogcmVkcmF3LFxuICAgICAgICByZW5kZXJUbzogZnVuY3Rpb24oKSB7IHJldHVybiBzZWxmLnJlbmRlclRvIH0sXG4gICAgICAgIHJlc2l6ZTogcmVzaXplLFxuICAgICAgICB4QXhpczogZnVuY3Rpb24oKSB7IHJldHVybiB4QXhpcyB9LFxuICAgICAgICB4U2NhbGU6IGZ1bmN0aW9uKCkgeyByZXR1cm4geFNjYWxlIH0sXG4gICAgICAgIHlTY2FsZTogZnVuY3Rpb24oKSB7IHJldHVybiB5U2NhbGUgfSxcbiAgICAgICAgeUF4aXM6IGZ1bmN0aW9uKCkgeyByZXR1cm4geUF4aXMgfSxcbiAgICAgICAgem9vbTogZnVuY3Rpb24oKSB7IHJldHVybiB6b29tIH0sXG4gICAgfTtcblxuICAgIHNlbGYuaXRlbXMgPSBudWxsO1xuICAgIHNlbGYubGFuZXMgPSBudWxsO1xuICAgIHNlbGYucmVuZGVyVG8gPSAnI2dhbnR0X2NoYXJ0JztcbiAgICBzZWxmLnN1YmxhbmVzID0gMTtcblxuICAgIHNlbGYuaXNBdXRvUmVzaXplID0gdHJ1ZTtcbiAgICBzZWxmLmlzRW5hYmxlRHJhZyA9IHRydWU7XG4gICAgc2VsZi5pc0VuYWJsZVRvb2x0aXAgPSB0cnVlO1xuICAgIHNlbGYuaXNFbmFibGVab29tID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1hHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1lHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd0xhbmVMYWJlbCA9IHRydWU7XG5cbiAgICBzZWxmLmhlaWdodCA9IG51bGw7XG4gICAgc2VsZi53aWR0aCA9IG51bGw7XG4gICAgc2VsZi5tYXJnaW4gPSB7XG4gICAgICAgIHRvcDogMjAsXG4gICAgICAgIHJpZ2h0OiAxNSxcbiAgICAgICAgYm90dG9tOiAyMCxcbiAgICAgICAgbGVmdDogMjBcbiAgICB9O1xuXG4gICAgKGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGNvcHlTYW1lUHJvcChzZWxmLCBjb25mKTtcblxuICAgICAgICBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcyB8fCBbXTtcbiAgICAgICAgc2VsZi5sYW5lcyA9IHNlbGYubGFuZXMgfHwgW107XG4gICAgICAgIHNlbGYubGFuZXMubGVuZ3RoID0gZ2V0TGFuZUxlbmd0aCgpO1xuXG4gICAgICAgIGlmIChzZWxmLmhlaWdodCA9PT0gbnVsbCkgc2VsZi5oZWlnaHQgPSBwYXJzZUludChkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbykuc3R5bGUoJ2hlaWdodCcpKSB8fCA0ODA7XG4gICAgICAgIGlmIChzZWxmLndpZHRoID09PSBudWxsKSBzZWxmLndpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KHNlbGYucmVuZGVyVG8pLnN0eWxlKCd3aWR0aCcpKSB8fCA2NDA7XG5cbiAgICAgICAgYnVpbGQoKTtcbiAgICAgICAgYXV0b3Jlc2l6ZShzZWxmLmlzQXV0b1Jlc2l6ZSk7XG4gICAgICAgIGVuYWJsZURyYWcoc2VsZi5pc0VuYWJsZURyYWcpO1xuICAgICAgICBlbmFibGVUb29sdGlwKHNlbGYuaXNFbmFibGVUb29sdGlwKTtcbiAgICAgICAgZW5hYmxlWm9vbShzZWxmLmlzRW5hYmxlWm9vbSk7XG4gICAgICAgIHNob3dMYW5lTGFiZWwoc2VsZi5pc0VuYWJsZVRvb2x0aXApO1xuICAgICAgICBzaG93WEdyaWQoc2VsZi5pc1Nob3dYR3JpZCk7XG4gICAgICAgIHNob3dZR3JpZChzZWxmLmlzU2hvd1lHcmlkKTtcbiAgICAgICAgcmVkcmF3KCk7XG4gICAgfSkoKTtcblxuICAgIGZ1bmN0aW9uIGFkZEl0ZW1zKG5ld0l0ZW1zKSB7XG4gICAgICAgIHZhciBpdGVtc1R5cGUgPSB0b1N0ci5jYWxsKG5ld0l0ZW1zKTtcbiAgICAgICAgaWYgKGl0ZW1zVHlwZSAhPT0gYXN0ciAmJiBpdGVtc1R5cGUgIT09IG9zdHIpIHRocm93RXJyb3IoJ0V4cGVjdGVkIG9iamVjdCBvciBhcnJheS4gR290OiAnICsgaXRlbXNUeXBlKTtcbiAgICAgICAgKGl0ZW1zVHlwZSA9PT0gYXN0cikgPyBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcy5jb25jYXQobmV3SXRlbXMpIDogc2VsZi5pdGVtcy5wdXNoKG5ld0l0ZW1zKTtcbiAgICAgICAgb25JdGVtc0NoYW5nZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF1dG9yZXNpemUoaXNBdXRvUmVzaXplKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNBdXRvUmVzaXplO1xuICAgICAgICBkMy5zZWxlY3Qod2luZG93KS5vbigncmVzaXplJywgKGlzQXV0b1Jlc2l6ZSAhPT0gZmFsc2UpID8gcmVzaXplIDogbnVsbCk7XG4gICAgICAgIHNlbGYuaXNBdXRvUmVzaXplID0gaXNBdXRvUmVzaXplO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkKCkge1xuICAgICAgICB2YXIgbGFuZUxlbmd0aCA9IHNlbGYubGFuZXMubGVuZ3RoLFxuICAgICAgICAgICAgbWFyZ2luV2lkdGggPSBnZXRNYXJnaW5XaWR0aCgpLFxuICAgICAgICAgICAgbWFyZ2luSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCk7XG5cbiAgICAgICAgY2hhcnQgPSBkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbylcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgc2VsZi53aWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNlbGYuaGVpZ2h0KVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LWNoYXJ0XCIpO1xuXG4gICAgICAgIGNoYXJ0LmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwiY2xpcFBhdGhcIilcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbGlwXCIpXG4gICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodCk7XG5cbiAgICAgICAgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwiZHJhZ3N0YXJ0XCIsIGRyYWdzdGFydClcbiAgICAgICAgICAgIC5vbihcImRyYWdcIiwgZHJhZ21vdmUpXG4gICAgICAgICAgICAub24oXCJkcmFnZW5kXCIsIGRyYWdlbmQpO1xuXG4gICAgICAgIG1haW4gPSBjaGFydC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodClcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJtYWluXCIpO1xuXG4gICAgICAgIGl0ZW1SZWN0cyA9IG1haW4uYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGlwLXBhdGhcIiwgXCJ1cmwoI2NsaXApXCIpO1xuXG4gICAgICAgIHRvb2x0aXBEaXYgPSBkMy5zZWxlY3QoXCJib2R5XCIpLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LXRvb2x0aXBcIilcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG5cbiAgICAgICAgeFNjYWxlID0gZDMudGltZS5zY2FsZSgpXG4gICAgICAgICAgICAuZG9tYWluKGdldFRpbWVEb21haW4oKSlcbiAgICAgICAgICAgIC5yYW5nZShbMCwgbWFyZ2luV2lkdGhdKTtcblxuICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgLmRvbWFpbihbMCwgbGFuZUxlbmd0aF0pXG4gICAgICAgICAgICAucmFuZ2UoWzAsIG1hcmdpbkhlaWdodF0pO1xuXG4gICAgICAgIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcbiAgICAgICAgICAgIC5vcmllbnQoJ2JvdHRvbScpXG4gICAgICAgICAgICAudGlja3MoNSlcblxuICAgICAgICB5QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgICAgICAgICAgIC5zY2FsZSh5U2NhbGUpXG4gICAgICAgICAgICAub3JpZW50KCdsZWZ0JylcbiAgICAgICAgICAgIC50aWNrcyhsYW5lTGVuZ3RoKVxuICAgICAgICAgICAgLnRpY2tGb3JtYXQoXCJcIik7XG5cbiAgICAgICAgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKVxuICAgICAgICAgICAgLngoeFNjYWxlKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBtYXJnaW5IZWlnaHQgKyAnKScpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbWFpbiBheGlzIGRhdGUnKVxuICAgICAgICAgICAgLmNhbGwoeEF4aXMpXG5cbiAgICAgICAgbWFpbi5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ21haW4gYXhpcyBsYW5lJylcbiAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGFuZUxhYmVscycpO1xuXG4gICAgICAgIGNoYXJ0LmNhbGwoem9vbSk7XG5cbiAgICAgICAgZDMuc2VsZWN0KCdodG1sJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXNFbmFibGVUb29sdGlwKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCdzdmcgcmVjdCcpKSB7XG4gICAgICAgICAgICAgICAgaGlkZVRvb2x0aXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZHJhZ21vdmUoKSB7XG4gICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGQzLmV2ZW50LngpXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZDMuZXZlbnQueSlcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmFnZW5kKGQpIHtcbiAgICAgICAgdmFyIGVsID0gZDMuc2VsZWN0KHRoaXMpLFxuICAgICAgICAgICAgbGFuZSA9IE1hdGgucm91bmQoeVNjYWxlLmludmVydChlbC5hdHRyKFwieVwiKSkpLFxuICAgICAgICAgICAgc3RhcnQgPSBlbC5hdHRyKFwieFwiKTtcblxuICAgICAgICBpZiAobGFuZSA+PSBzZWxmLmxhbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbGFuZSA9IHNlbGYubGFuZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZSA8IDApIHtcbiAgICAgICAgICAgIGxhbmUgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsLmF0dHIoXCJ5XCIsIHlTY2FsZShsYW5lKSk7XG4gICAgICAgIGQubGFuZSA9IGxhbmU7XG4gICAgICAgIGQuc3RhcnQgPSBEYXRlLnBhcnNlKHhTY2FsZS5pbnZlcnQoc3RhcnQpKTtcbiAgICAgICAgZC5lbmQgPSBEYXRlLnBhcnNlKHhTY2FsZS5pbnZlcnQocGFyc2VGbG9hdChlbC5hdHRyKFwid2lkdGhcIikpICsgcGFyc2VGbG9hdChzdGFydCkpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmFnc3RhcnQoKSB7XG4gICAgICAgIGQzLmV2ZW50LnNvdXJjZUV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNvcHlTYW1lUHJvcChjb3B5VG8sIGNvcHlGcm9tKSB7XG4gICAgICAgIHZhciBwO1xuXG4gICAgICAgIGZvciAocCBpbiBjb3B5RnJvbSkge1xuICAgICAgICAgICAgaWYgKGNvcHlUby5oYXNPd25Qcm9wZXJ0eShwKSkge1xuICAgICAgICAgICAgICAgIGlmICh0b1N0ci5jYWxsKGNvcHlGcm9tW3BdKSA9PT0gb3N0cikge1xuICAgICAgICAgICAgICAgICAgICBjb3B5U2FtZVByb3AoY29weVRvW3BdLCBjb3B5RnJvbVtwXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb3B5VG9bcF0gPSBjb3B5RnJvbVtwXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmFibGVEcmFnKGlzRW5hYmxlRHJhZykge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzRW5hYmxlRHJhZztcbiAgICAgICAgZHJhZy5vbihcImRyYWdzdGFydFwiLCAoaXNFbmFibGVEcmFnKSA/IGRyYWdzdGFydCA6IG51bGwpXG4gICAgICAgICAgICAub24oXCJkcmFnXCIsIChpc0VuYWJsZURyYWcpID8gZHJhZ21vdmUgOiBudWxsKVxuICAgICAgICAgICAgLm9uKFwiZHJhZ2VuZFwiLCAoaXNFbmFibGVEcmFnKSA/IGRyYWdlbmQgOiBudWxsKTtcbiAgICAgICAgc2VsZi5pc0VuYWJsZURyYWcgPSBpc0VuYWJsZURyYWc7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZW5hYmxlVG9vbHRpcChpc0VuYWJsZVRvb2x0aXApIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pc0VuYWJsZVRvb2x0aXA7XG4gICAgICAgIHNlbGYuaXNFbmFibGVUb29sdGlwID0gaXNFbmFibGVUb29sdGlwO1xuICAgICAgICByZWRyYXcoKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmFibGVab29tKGlzRW5hYmxlWm9vbSkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzRW5hYmxlWm9vbTtcbiAgICAgICAgem9vbS5vbihcInpvb21cIiwgKGlzRW5hYmxlWm9vbSkgPyByZWRyYXcgOiBudWxsKTtcbiAgICAgICAgc2VsZi5pc0VuYWJsZVpvb20gPSBpc0VuYWJsZVpvb207XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0TGFuZUxlbmd0aCgpIHtcbiAgICAgICAgcmV0dXJuIChkMy5tYXgoc2VsZi5pdGVtcywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sYW5lIH0pICsgMSkgfHwgMDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRNYXJnaW5XaWR0aCgpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYud2lkdGggLSBzZWxmLm1hcmdpbi5yaWdodCAtIHNlbGYubWFyZ2luLmxlZnQ7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0TWFyZ2luSGVpZ2h0KCkge1xuICAgICAgICByZXR1cm4gc2VsZi5oZWlnaHQgLSBzZWxmLm1hcmdpbi50b3AgLSBzZWxmLm1hcmdpbi5ib3R0b207XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VGltZURvbWFpbigpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIGQzLm1pbihzZWxmLml0ZW1zLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnN0YXJ0IH0pLFxuICAgICAgICAgICAgZDMubWF4KHNlbGYuaXRlbXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuZW5kIH0pXG4gICAgICAgIF07XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaGlkZVRvb2x0aXAoKSB7XG4gICAgICAgIHRvb2x0aXBEaXYudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oNTAwKVxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAwKVxuICAgICAgICAgICAgLnN0eWxlKFwiZGlzcGxheVwiLCBcIm5vbmVcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gaXRlbXMobmV3SXRlbXMpIHtcbiAgICAgICAgdmFyIGl0ZW1zVHlwZSA9IHRvU3RyLmNhbGwobmV3SXRlbXMpO1xuXG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXRlbXM7XG4gICAgICAgIGlmIChpdGVtc1R5cGUgIT09IGFzdHIpIHRocm93RXJyb3IoJ0V4cGVjdGVkIGFycmF5LiBHb3Q6ICcgKyBpdGVtc1R5cGUpO1xuICAgICAgICBzZWxmLml0ZW1zID0gbmV3SXRlbXM7XG5cbiAgICAgICAgb25JdGVtc0NoYW5nZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxhbmVzKG5ld0xhbmVzKSB7XG4gICAgICAgIHZhciBsYW5lc1R5cGUgPSB0b1N0ci5jYWxsKG5ld0xhbmVzKTtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5sYW5lcztcbiAgICAgICAgaWYgKGxhbmVzVHlwZSAhPT0gYXN0cikgdGhyb3dFcnJvcignRXhwZWN0ZWQgYXJyYXkuIEdvdDogJyArIGxhbmVzVHlwZSk7XG4gICAgICAgIHNlbGYubGFuZXMgPSBuZXdMYW5lcztcbiAgICAgICAgc2VsZi5sYW5lcy5sZW5ndGggPSBnZXRMYW5lTGVuZ3RoKCkgfHwgc2VsZi5sYW5lcy5sZW5ndGg7XG4gICAgICAgIHNob3dMYW5lTGFiZWwoIXNlbGYuaXNTaG93TGFuZUxhYmVsKTtcbiAgICAgICAgc2hvd0xhbmVMYWJlbCghc2VsZi5pc1Nob3dMYW5lTGFiZWwpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG1hcmdpbihuZXdNYXJnaW4pIHtcbiAgICAgICAgdmFyIG1zZyA9IFwiIG1hcmdpbiB2YWx1ZSBpcyBpbmNvcnJlY3QuIEFsbCB2YWx1ZXMgc2hvdWxkIGJlIG51bWJlcnNcIjtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5tYXJnaW47XG4gICAgICAgIGlmIChuZXdNYXJnaW4udG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChpc05hTihuZXdNYXJnaW4udG9wKSkgdGhyb3dFcnJvcihcIidUb3AnXCIgKyBtc2cpO1xuICAgICAgICAgICAgc2VsZi5tYXJnaW4udG9wID0gcGFyc2VJbnQobmV3TWFyZ2luLnRvcCk7XG4gICAgICAgICAgICBtYWluLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBzZWxmLm1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBzZWxmLm1hcmdpbi50b3AgKyBcIilcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld01hcmdpbi5yaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3TWFyZ2luLnJpZ2h0KSkgdGhyb3dFcnJvcihcIidSaWdodCdcIiArIG1zZyk7XG4gICAgICAgICAgICBzZWxmLm1hcmdpbi5yaWdodCA9IHBhcnNlSW50KG5ld01hcmdpbi5yaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld01hcmdpbi5ib3R0b20gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld01hcmdpbi5ib3R0b20pKSB0aHJvd0Vycm9yKFwiJ0JvdHRvbSdcIiArIG1zZyk7XG4gICAgICAgICAgICBzZWxmLm1hcmdpbi5ib3R0b20gPSBwYXJzZUludChuZXdNYXJnaW4uYm90dG9tKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFyZ2luLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld01hcmdpbi5sZWZ0KSkgdGhyb3dFcnJvcihcIidMZWZ0J1wiICsgbXNnKTtcbiAgICAgICAgICAgIHNlbGYubWFyZ2luLmxlZnQgPSBwYXJzZUludChuZXdNYXJnaW4ubGVmdCk7XG4gICAgICAgICAgICBtYWluLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgXCJ0cmFuc2xhdGUoXCIgKyBzZWxmLm1hcmdpbi5sZWZ0ICsgXCIsXCIgKyBzZWxmLm1hcmdpbi50b3AgKyBcIilcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXNpemUoKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBvbkl0ZW1zQ2hhbmdlKCkge1xuICAgICAgICB2YXIgbGFuZUxlbmd0aCA9IGdldExhbmVMZW5ndGgoKTtcbiAgICAgICAgc2VsZi5sYW5lcy5sZW5ndGggPSBsYW5lTGVuZ3RoO1xuICAgICAgICB4U2NhbGUuZG9tYWluKGdldFRpbWVEb21haW4oKSk7XG4gICAgICAgIHlBeGlzLnRpY2tzKGxhbmVMZW5ndGgpO1xuICAgICAgICB5U2NhbGUuZG9tYWluKFswLCBsYW5lTGVuZ3RoXSk7XG4gICAgICAgIHpvb20ueCh4U2NhbGUpO1xuICAgICAgICByZWRyYXcoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWRyYXcoKSB7XG4gICAgICAgIHZhciBpdGVtSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCkgLyAoc2VsZi5sYW5lcy5sZW5ndGggfHwgMSkgLyAoc2VsZi5zdWJsYW5lcyB8fCAxKSxcbiAgICAgICAgICAgIHJlY3RzO1xuXG4gICAgICAgIHJlY3RzID0gaXRlbVJlY3RzLnNlbGVjdEFsbChcInJlY3RcIilcbiAgICAgICAgICAgIC5kYXRhKHNlbGYuaXRlbXMsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmlkOyB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5zdGFydCk7IH0pXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHNlbGYuc3VibGFuZXMgPCAyKSA/IHlTY2FsZShkLmxhbmUpIDogeVNjYWxlKGQubGFuZSkgKyBkLnN1YmxhbmUqaXRlbUhlaWdodDtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiB4U2NhbGUoZC5lbmQpIC0geFNjYWxlKGQuc3RhcnQpOyB9KVxuICAgICAgICAgICAgLmF0dHIoXCJoZWlnaHRcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGl0ZW1IZWlnaHQ7IH0pXG4gICAgICAgICAgICAuY2FsbChkcmFnKVxuICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKHNlbGYuaXNFbmFibGVUb29sdGlwKSA/IHNob3dUb29sdGlwIDogbnVsbCk7XG4gICAgICAgIHJlY3RzLmVudGVyKCkuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jbGFzcyArICcgbWFpbic7IH0pXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLnN0YXJ0KTsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoc2VsZi5zdWJsYW5lcyA8IDIpID8geVNjYWxlKGQubGFuZSkgOiB5U2NhbGUoZC5sYW5lKSArIGQuc3VibGFuZSppdGVtSGVpZ2h0O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLmVuZCkgLSB4U2NhbGUoZC5zdGFydCk7IH0pXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gIGl0ZW1IZWlnaHQ7IH0pXG4gICAgICAgICAgICAuYXR0cihcIm9wYWNpdHlcIiwgLjc1KVxuICAgICAgICAgICAgLmNhbGwoZHJhZylcbiAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIChzZWxmLmlzRW5hYmxlVG9vbHRpcCkgPyBzaG93VG9vbHRpcCA6IG51bGwpO1xuICAgICAgICByZWN0cy5leGl0KCkucmVtb3ZlKCk7XG5cbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubWFpbi5heGlzLmRhdGUnKS5jYWxsKHhBeGlzKTtcbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubWFpbi5heGlzLmxhbmUnKS5jYWxsKHlBeGlzKTtcblxuICAgICAgICBoaWRlVG9vbHRpcCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlc2l6ZSgpIHtcbiAgICAgICAgaWYgKHNlbGYuaXNBdXRvUmVzaXplKSB7XG4gICAgICAgICAgICBzZWxmLndpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KHNlbGYucmVuZGVyVG8pLnN0eWxlKCd3aWR0aCcpKTtcbiAgICAgICAgICAgIHNlbGYuaGVpZ2h0ID0gcGFyc2VJbnQoZDMuc2VsZWN0KHNlbGYucmVuZGVyVG8pLnN0eWxlKCdoZWlnaHQnKSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG1hcmdpbldpZHRoID0gZ2V0TWFyZ2luV2lkdGgoKSxcbiAgICAgICAgICAgIG1hcmdpbkhlaWdodCA9IGdldE1hcmdpbkhlaWdodCgpO1xuXG4gICAgICAgIHhTY2FsZS5yYW5nZShbMCwgbWFyZ2luV2lkdGhdKTtcbiAgICAgICAgeVNjYWxlLnJhbmdlKFswLCBtYXJnaW5IZWlnaHRdKTtcbiAgICAgICAgY2hhcnQuYXR0cihcIndpZHRoXCIsIHNlbGYud2lkdGgpO1xuICAgICAgICBjaGFydC5hdHRyKFwiaGVpZ2h0XCIsIHNlbGYuaGVpZ2h0KTtcbiAgICAgICAgY2hhcnQuc2VsZWN0KCdkZWZzJykuc2VsZWN0KCdjbGlwUGF0aCcpLnNlbGVjdCgncmVjdCcpLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aCk7XG4gICAgICAgIGNoYXJ0LnNlbGVjdCgnZGVmcycpLnNlbGVjdCgnY2xpcFBhdGgnKS5zZWxlY3QoJ3JlY3QnKS5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbldpZHRoKTtcbiAgICAgICAgbWFpbi5hdHRyKFwid2lkdGhcIiwgbWFyZ2luV2lkdGgpO1xuICAgICAgICBtYWluLmF0dHIoXCJoZWlnaHRcIiwgbWFyZ2luSGVpZ2h0KTtcblxuICAgICAgICBtYWluLnNlbGVjdCgnZy5tYWluLmF4aXMuZGF0ZScpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBnZXRNYXJnaW5IZWlnaHQoKSArICcpJyk7XG5cbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubGFuZUxhYmVscycpXG4gICAgICAgICAgICAuc2VsZWN0QWxsKFwiLmxhbmVUZXh0XCIpXG4gICAgICAgICAgICAuZGF0YShzZWxmLmxhbmVzKVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQsIGkpIHtyZXR1cm4geVNjYWxlKGkgKyAuNSk7fSlcblxuICAgICAgICB6b29tLngoeFNjYWxlKTtcblxuICAgICAgICBzaG93WEdyaWQoc2VsZi5pc1Nob3dZR3JpZCk7XG4gICAgICAgIHNob3dZR3JpZChzZWxmLmlzU2hvd1lHcmlkKTtcblxuICAgICAgICByZWRyYXcoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93TGFuZUxhYmVsKGlzU2hvd0xhbmVMYWJlbCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzU2hvd0xhbmVMYWJlbDtcbiAgICAgICAgc2VsZi5pc1Nob3dMYW5lTGFiZWwgPSBpc1Nob3dMYW5lTGFiZWw7XG4gICAgICAgIGlmIChpc1Nob3dMYW5lTGFiZWwgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBtYWluLnNlbGVjdEFsbChcIi5sYW5lVGV4dFwiKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG1haW4uc2VsZWN0KCdnLmxhbmVMYWJlbHMnKS5zZWxlY3RBbGwoXCIubGFuZVRleHRcIilcbiAgICAgICAgICAgICAgICAuZGF0YShzZWxmLmxhbmVzKVxuICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZChcInRleHRcIilcbiAgICAgICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7cmV0dXJuIGQ7fSlcbiAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgLXNlbGYubWFyZ2luLnJpZ2h0KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkLCBpKSB7cmV0dXJuIHlTY2FsZShpICsgLjUpO30pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJkeVwiLCBcIi41ZXhcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcInRleHQtYW5jaG9yXCIsIFwic3RhcnRcIilcbiAgICAgICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIFwibGFuZVRleHRcIik7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dUb29sdGlwKGQpIHtcbiAgICAgICAgaWYgKGQzLmV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjtcbiAgICAgICAgdG9vbHRpcERpdi5zdHlsZShcImRpc3BsYXlcIiwgXCJibG9ja1wiKVxuICAgICAgICAgICAgLnRyYW5zaXRpb24oKVxuICAgICAgICAgICAgLmR1cmF0aW9uKDIwMClcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgLjkpO1xuICAgICAgICB0b29sdGlwRGl2Lmh0bWwoKHR5cGVvZiBkLnRvb2x0aXAgPT09ICdmdW5jdGlvbicpID8gZC50b29sdGlwKCkgOiBkLnRvb2x0aXApXG4gICAgICAgICAgICAuc3R5bGUoXCJsZWZ0XCIsIChkMy5ldmVudC5wYWdlWCkgKyBcInB4XCIpXG4gICAgICAgICAgICAuc3R5bGUoXCJ0b3BcIiwgKGQzLmV2ZW50LnBhZ2VZKSArIFwicHhcIik7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd1hHcmlkKGlzU2hvd1hHcmlkKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNTaG93WEdyaWQ7XG4gICAgICAgIHZhciBoZWlnaHQgPSAoaXNTaG93WEdyaWQgIT09IGZhbHNlKSA/IC1nZXRNYXJnaW5IZWlnaHQoKSA6IC02O1xuICAgICAgICB4QXhpcy50aWNrU2l6ZShoZWlnaHQsIDAsIDApO1xuICAgICAgICBzZWxmLmlzU2hvd1hHcmlkID0gaXNTaG93WEdyaWQ7XG4gICAgICAgIG1haW4uc2VsZWN0KCdnLm1haW4uYXhpcy5kYXRlJykuY2FsbCh4QXhpcyk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd1lHcmlkKGlzU2hvd1lHcmlkKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNTaG93WUdyaWQ7XG4gICAgICAgIHZhciB3aWR0aCA9IChpc1Nob3dZR3JpZCAhPT0gZmFsc2UpID8gLWdldE1hcmdpbldpZHRoKCkgOiAtNjtcbiAgICAgICAgeUF4aXMudGlja1NpemUod2lkdGgsIDAsIDApO1xuICAgICAgICBzZWxmLmlzU2hvd1lHcmlkID0gaXNTaG93WUdyaWQ7XG4gICAgICAgIG1haW4uc2VsZWN0KCdnLm1haW4uYXhpcy5sYW5lJykuY2FsbCh5QXhpcyk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2l6ZSh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIFtzZWxmLndpZHRoLCBzZWxmLmhlaWdodF07XG4gICAgICAgIHNlbGYud2lkdGggPSBwYXJzZUludCh3aWR0aCkgfHwgc2VsZi53aWR0aDtcbiAgICAgICAgc2VsZi5oZWlnaHQgPSBwYXJzZUludChoZWlnaHQpIHx8IHNlbGYuaGVpZ2h0O1xuICAgICAgICBhdXRvcmVzaXplKGZhbHNlKTtcbiAgICAgICAgcmVzaXplKCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc3VibGFuZXMobmV3U3VibGFuZXMpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5zdWJsYW5lcztcbiAgICAgICAgc2VsZi5zdWJsYW5lcyA9IG5ld1N1YmxhbmVzO1xuICAgICAgICByZWRyYXcoKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0aHJvd0Vycm9yKG1zZykge1xuICAgICAgICB0aHJvdyBUeXBlRXJyb3IobXNnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXBpO1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
