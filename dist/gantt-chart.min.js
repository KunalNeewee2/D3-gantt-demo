"use strict";var ganttChart=function(t){function e(t){var e=B.call(t);return e!==C&&e!==M&&A("Expected object or array. Got: "+e),e===C?O.items=O.items.concat(t):O.items.push(t),v(),I}function n(t){return arguments.length?(d3.select(window).on("resize",t!==!1?y:null),O.isAutoResize=t,I):O.isAutoResize}function a(){var t=O.lanes.length,e=h(),n=g();k=d3.select(O.renderTo).append("svg").attr("width",O.width).attr("height",O.height).attr("class","gantt-chart"),k.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",n),N=d3.behavior.drag().on("dragstart",l).on("drag",r).on("dragend",i),Y=k.append("g").attr("transform","translate("+O.margin.left+","+O.margin.top+")").attr("width",e).attr("height",n).attr("class","main"),D=Y.append("g").attr("clip-path","url(#clip)"),P=d3.select("body").append("div").attr("class","gantt-tooltip").style("opacity",0),X=d3.time.scale().domain(p()).range([0,e]),F=d3.scale.linear().domain([0,t]).range([0,n]),R=d3.svg.axis().scale(X).orient("bottom").ticks(5),j=d3.svg.axis().scale(F).orient("left").ticks(t).tickFormat(""),Z=d3.behavior.zoom().x(X),Y.append("g").attr("transform","translate(0,"+n+")").attr("class","main axis date").call(R),Y.append("g").attr("class","main axis lane").call(j),Y.append("g").attr("class","laneLabels"),k.call(Z),d3.select("html").on("click",function(t){O.isEnableTooltip&&(event.target.closest("svg rect")||f())})}function r(){d3.select(this).attr("x",parseFloat(d3.select(this).attr("x"))+d3.event.dx).attr("y",parseFloat(d3.select(this).attr("y"))+d3.event.dy)}function i(t){var e=d3.select(this),n=Math.round(F.invert(e.attr("y"))),a=e.attr("x");n>=O.lanes.length&&(n=O.lanes.length-1),0>n&&(n=0),e.attr("y",F(n)),t.lane=n,t.start=Date.parse(X.invert(a)),t.end=Date.parse(X.invert(parseFloat(e.attr("width"))+parseFloat(a)))}function l(){d3.event.sourceEvent.stopPropagation()}function s(t,e){var n;for(n in e)t.hasOwnProperty(n)&&(B.call(e[n])===M?s(t[n],e[n]):t[n]=e[n])}function o(t){return arguments.length?(N.on("dragstart",t?l:null).on("drag",t?r:null).on("dragend",t?i:null),O.isEnableDrag=t,I):O.isEnableDrag}function c(t){return arguments.length?(O.isEnableTooltip=t,x(),I):O.isEnableTooltip}function u(t){return arguments.length?(Z.on("zoom",t?x:null),O.isEnableZoom=t,I):O.isEnableZoom}function d(){return d3.max(O.items,function(t){return t.lane})+1||0}function h(){return O.width-O.margin.right-O.margin.left}function g(){return O.height-O.margin.top-O.margin.bottom}function p(){return[d3.min(O.items,function(t){return t.start}),d3.max(O.items,function(t){return t.end})]}function f(){P.transition().duration(500).style("opacity",0).style("display","none")}function m(t){var e=B.call(t);return arguments.length?(e!==C&&A("Expected array. Got: "+e),O.items=t,v(),I):O.items}function b(t){var e=B.call(t);return arguments.length?(e!==C&&A("Expected array. Got: "+e),O.lanes=t,O.lanes.length=d()||O.lanes.length,T(!O.isShowLaneLabel),T(!O.isShowLaneLabel),I):O.lanes}function w(t){var e=" margin value is incorrect. All values should be numbers";return arguments.length?(void 0!==t.top&&(isNaN(t.top)&&A("'Top'"+e),O.margin.top=parseInt(t.top),Y.attr("transform","translate("+O.margin.left+","+O.margin.top+")")),void 0!==t.right&&(isNaN(t.right)&&A("'Right'"+e),O.margin.right=parseInt(t.right)),void 0!==t.bottom&&(isNaN(t.bottom)&&A("'Bottom'"+e),O.margin.bottom=parseInt(t.bottom)),void 0!==t.left&&(isNaN(t.left)&&A("'Left'"+e),O.margin.left=parseInt(t.left),Y.attr("transform","translate("+O.margin.left+","+O.margin.top+")")),y(),I):O.margin}function v(){var t=d();O.lanes.length=t,X.domain(p()),j.ticks(t),F.domain([0,t]),Z.x(X),x()}function x(){var t,e=g()/(O.lanes.length||1)/(O.sublanes||1);t=D.selectAll("rect").data(O.items,function(t){return t.id}).attr("x",function(t){return X(t.start)}).attr("y",function(t){return O.sublanes<2?F(t.lane):F(t.lane)+t.sublane*e}).attr("width",function(t){return X(t.end)-X(t.start)}).attr("height",function(t){return e}).call(N).on("click",O.isEnableTooltip?E:null),t.enter().append("rect").attr("class",function(t){return t["class"]+" main"}).attr("x",function(t){return X(t.start)}).attr("y",function(t){return O.sublanes<2?F(t.lane):F(t.lane)+t.sublane*e}).attr("width",function(t){return X(t.end)-X(t.start)}).attr("height",function(t){return e}).attr("opacity",.75).call(N).on("click",O.isEnableTooltip?E:null),t.exit().remove(),Y.select("g.main.axis.date").call(R),Y.select("g.main.axis.lane").call(j),f()}function y(){O.isAutoResize&&(O.width=parseInt(d3.select(O.renderTo).style("width")),O.height=parseInt(d3.select(O.renderTo).style("height")));var t=h(),e=g();X.range([0,t]),F.range([0,e]),k.attr("width",O.width),k.attr("height",O.height),k.select("defs").select("clipPath").select("rect").attr("width",t),k.select("defs").select("clipPath").select("rect").attr("height",t),Y.attr("width",t),Y.attr("height",e),Y.select("g.main.axis.date").attr("transform","translate(0,"+g()+")"),Y.select("g.laneLabels").selectAll(".laneText").data(O.lanes).attr("y",function(t,e){return F(e+.5)}),Z.x(X),S(O.isShowYGrid),L(O.isShowYGrid),x()}function T(t){return arguments.length?(O.isShowLaneLabel=t,t===!1?Y.selectAll(".laneText").remove():Y.select("g.laneLabels").selectAll(".laneText").data(O.lanes).enter().append("text").text(function(t){return t}).attr("x",-O.margin.right).attr("y",function(t,e){return F(e+.5)}).attr("dy",".5ex").attr("text-anchor","start").attr("class","laneText"),I):O.isShowLaneLabel}function E(t){d3.event.defaultPrevented||(P.style("display","block").transition().duration(200).style("opacity",.9),P.html("function"==typeof t.tooltip?t.tooltip():t.tooltip).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"))}function S(t){if(!arguments.length)return O.isShowXGrid;var e=t!==!1?-g():-6;return R.tickSize(e,0,0),O.isShowXGrid=t,Y.select("g.main.axis.date").call(R),I}function L(t){if(!arguments.length)return O.isShowYGrid;var e=t!==!1?-h():-6;return j.tickSize(e,0,0),O.isShowYGrid=t,Y.select("g.main.axis.lane").call(j),I}function G(t,e){return arguments.length?(O.width=parseInt(t)||O.width,O.height=parseInt(e)||O.height,n(!1),y(),I):[O.width,O.height]}function z(t){return arguments.length?(O.sublanes=t,x(),I):O.sublanes}function A(t){throw TypeError(t)}var I,k,N,Y,D,P,R,X,j,F,Z,O={},B=Object.prototype.toString,C="[object Array]",M="[object Object]";return I={addItems:e,autoresize:n,enableDrag:o,enableTooltip:c,enableZoom:u,chart:function(){return Y},drag:function(){return N},items:m,lanes:b,margin:w,showLaneLabel:T,showXGrid:S,showYGrid:L,size:G,sublanes:z,svg:function(){return k},redraw:x,renderTo:function(){return O.renderTo},resize:y,xAxis:function(){return R},xScale:function(){return X},yScale:function(){return F},yAxis:function(){return j},zoom:function(){return Z}},O.items=null,O.lanes=null,O.renderTo="#gantt_chart",O.sublanes=1,O.isAutoResize=!0,O.isEnableDrag=!0,O.isEnableTooltip=!0,O.isEnableZoom=!0,O.isShowXGrid=!0,O.isShowYGrid=!0,O.isShowLaneLabel=!0,O.height=null,O.width=null,O.margin={top:20,right:15,bottom:20,left:20},function(){s(O,t),O.items=O.items||[],O.lanes=O.lanes||[],O.lanes.length=d(),null===O.height&&(O.height=parseInt(d3.select(O.renderTo).style("height"))||480),null===O.width&&(O.width=parseInt(d3.select(O.renderTo).style("width"))||640),a(),n(O.isAutoResize),o(O.isEnableDrag),c(O.isEnableTooltip),u(O.isEnableZoom),T(O.isEnableTooltip),S(O.isShowXGrid),L(O.isShowYGrid),x()}(),I};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbnR0LWNoYXJ0LmpzIl0sIm5hbWVzIjpbImdhbnR0Q2hhcnQiLCJjb25mIiwiYWRkSXRlbXMiLCJuZXdJdGVtcyIsIml0ZW1zVHlwZSIsInRvU3RyIiwiY2FsbCIsImFzdHIiLCJvc3RyIiwidGhyb3dFcnJvciIsInNlbGYiLCJpdGVtcyIsImNvbmNhdCIsInB1c2giLCJvbkl0ZW1zQ2hhbmdlIiwiYXBpIiwiYXV0b3Jlc2l6ZSIsImlzQXV0b1Jlc2l6ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsImQzIiwic2VsZWN0Iiwid2luZG93Iiwib24iLCJyZXNpemUiLCJidWlsZCIsImxhbmVMZW5ndGgiLCJsYW5lcyIsIm1hcmdpbldpZHRoIiwiZ2V0TWFyZ2luV2lkdGgiLCJtYXJnaW5IZWlnaHQiLCJnZXRNYXJnaW5IZWlnaHQiLCJjaGFydCIsInJlbmRlclRvIiwiYXBwZW5kIiwiYXR0ciIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhZyIsImJlaGF2aW9yIiwiZHJhZ3N0YXJ0IiwiZHJhZ21vdmUiLCJkcmFnZW5kIiwibWFpbiIsIm1hcmdpbiIsImxlZnQiLCJ0b3AiLCJpdGVtUmVjdHMiLCJ0b29sdGlwRGl2Iiwic3R5bGUiLCJ4U2NhbGUiLCJ0aW1lIiwic2NhbGUiLCJkb21haW4iLCJnZXRUaW1lRG9tYWluIiwicmFuZ2UiLCJ5U2NhbGUiLCJsaW5lYXIiLCJ4QXhpcyIsInN2ZyIsImF4aXMiLCJvcmllbnQiLCJ0aWNrcyIsInlBeGlzIiwidGlja0Zvcm1hdCIsInpvb20iLCJ4IiwiZCIsImlzRW5hYmxlVG9vbHRpcCIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImhpZGVUb29sdGlwIiwidGhpcyIsInBhcnNlRmxvYXQiLCJkeCIsImR5IiwiZWwiLCJsYW5lIiwiTWF0aCIsInJvdW5kIiwiaW52ZXJ0Iiwic3RhcnQiLCJEYXRlIiwicGFyc2UiLCJlbmQiLCJzb3VyY2VFdmVudCIsInN0b3BQcm9wYWdhdGlvbiIsImNvcHlTYW1lUHJvcCIsImNvcHlUbyIsImNvcHlGcm9tIiwicCIsImhhc093blByb3BlcnR5IiwiZW5hYmxlRHJhZyIsImlzRW5hYmxlRHJhZyIsImVuYWJsZVRvb2x0aXAiLCJyZWRyYXciLCJlbmFibGVab29tIiwiaXNFbmFibGVab29tIiwiZ2V0TGFuZUxlbmd0aCIsIm1heCIsInJpZ2h0IiwiYm90dG9tIiwibWluIiwidHJhbnNpdGlvbiIsImR1cmF0aW9uIiwibmV3TGFuZXMiLCJsYW5lc1R5cGUiLCJzaG93TGFuZUxhYmVsIiwiaXNTaG93TGFuZUxhYmVsIiwibmV3TWFyZ2luIiwibXNnIiwidW5kZWZpbmVkIiwiaXNOYU4iLCJwYXJzZUludCIsInJlY3RzIiwiaXRlbUhlaWdodCIsInN1YmxhbmVzIiwic2VsZWN0QWxsIiwiZGF0YSIsImlkIiwic3VibGFuZSIsInNob3dUb29sdGlwIiwiZW50ZXIiLCJleGl0IiwicmVtb3ZlIiwiaSIsInNob3dYR3JpZCIsImlzU2hvd1lHcmlkIiwic2hvd1lHcmlkIiwidGV4dCIsImRlZmF1bHRQcmV2ZW50ZWQiLCJodG1sIiwidG9vbHRpcCIsImlzU2hvd1hHcmlkIiwidGlja1NpemUiLCJzaXplIiwibmV3U3VibGFuZXMiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFJQSxZQUFhLFNBQVNDLEdBOEV0QixRQUFTQyxHQUFTQyxHQUNkLEdBQUlDLEdBQVlDLEVBQU1DLEtBQUtILEVBSTNCLE9BSElDLEtBQWNHLEdBQVFILElBQWNJLEdBQU1DLEVBQVcsa0NBQW9DTCxHQUM1RkEsSUFBY0csRUFBUUcsRUFBS0MsTUFBUUQsRUFBS0MsTUFBTUMsT0FBT1QsR0FBWU8sRUFBS0MsTUFBTUUsS0FBS1YsR0FDbEZXLElBQ09DLEVBR1gsUUFBU0MsR0FBV0MsR0FDaEIsTUFBS0MsV0FBVUMsUUFDZkMsR0FBR0MsT0FBT0MsUUFBUUMsR0FBRyxTQUFXTixLQUFpQixFQUFTTyxFQUFTLE1BQ25FZCxFQUFLTyxhQUFlQSxFQUNiRixHQUh1QkwsRUFBS08sYUFNdkMsUUFBU1EsS0FDTCxHQUFJQyxHQUFhaEIsRUFBS2lCLE1BQU1SLE9BQ3hCUyxFQUFjQyxJQUNkQyxFQUFlQyxHQUVuQkMsR0FBUVosR0FBR0MsT0FBT1gsRUFBS3VCLFVBQ2xCQyxPQUFPLE9BQ1BDLEtBQUssUUFBU3pCLEVBQUswQixPQUNuQkQsS0FBSyxTQUFVekIsRUFBSzJCLFFBQ3BCRixLQUFLLFFBQVMsZUFFbkJILEVBQU1FLE9BQU8sUUFBUUEsT0FBTyxZQUN2QkMsS0FBSyxLQUFNLFFBQ1hELE9BQU8sUUFDUEMsS0FBSyxRQUFTUCxHQUNkTyxLQUFLLFNBQVVMLEdBRXBCUSxFQUFPbEIsR0FBR21CLFNBQVNELE9BQ2RmLEdBQUcsWUFBYWlCLEdBQ2hCakIsR0FBRyxPQUFRa0IsR0FDWGxCLEdBQUcsVUFBV21CLEdBRW5CQyxFQUFPWCxFQUFNRSxPQUFPLEtBQ2ZDLEtBQUssWUFBYSxhQUFlekIsRUFBS2tDLE9BQU9DLEtBQU8sSUFBTW5DLEVBQUtrQyxPQUFPRSxJQUFNLEtBQzVFWCxLQUFLLFFBQVNQLEdBQ2RPLEtBQUssU0FBVUwsR0FDZkssS0FBSyxRQUFTLFFBRW5CWSxFQUFZSixFQUFLVCxPQUFPLEtBQ25CQyxLQUFLLFlBQWEsY0FFdkJhLEVBQWE1QixHQUFHQyxPQUFPLFFBQVFhLE9BQU8sT0FDakNDLEtBQUssUUFBUyxpQkFDZGMsTUFBTSxVQUFXLEdBRXRCQyxFQUFTOUIsR0FBRytCLEtBQUtDLFFBQ1pDLE9BQU9DLEtBQ1BDLE9BQU8sRUFBRzNCLElBRWY0QixFQUFTcEMsR0FBR2dDLE1BQU1LLFNBQ2JKLFFBQVEsRUFBRzNCLElBQ1g2QixPQUFPLEVBQUd6QixJQUVmNEIsRUFBUXRDLEdBQUd1QyxJQUFJQyxPQUNWUixNQUFNRixHQUNOVyxPQUFPLFVBQ1BDLE1BQU0sR0FFWEMsRUFBUTNDLEdBQUd1QyxJQUFJQyxPQUNWUixNQUFNSSxHQUNOSyxPQUFPLFFBQ1BDLE1BQU1wQyxHQUNOc0MsV0FBVyxJQUVoQkMsRUFBTzdDLEdBQUdtQixTQUFTMEIsT0FDZEMsRUFBRWhCLEdBRVBQLEVBQUtULE9BQU8sS0FDUEMsS0FBSyxZQUFhLGVBQWlCTCxFQUFlLEtBQ2xESyxLQUFLLFFBQVMsa0JBQ2Q3QixLQUFLb0QsR0FFVmYsRUFBS1QsT0FBTyxLQUNQQyxLQUFLLFFBQVMsa0JBQ2Q3QixLQUFLeUQsR0FFVnBCLEVBQUtULE9BQU8sS0FDUEMsS0FBSyxRQUFTLGNBRW5CSCxFQUFNMUIsS0FBSzJELEdBRVg3QyxHQUFHQyxPQUFPLFFBQVFFLEdBQUcsUUFBUyxTQUFTNEMsR0FDOUJ6RCxFQUFLMEQsa0JBQ0xDLE1BQU1DLE9BQU9DLFFBQVEsYUFDdEJDLE9BS1osUUFBUy9CLEtBQ0xyQixHQUFHQyxPQUFPb0QsTUFDTHRDLEtBQUssSUFBS3VDLFdBQVd0RCxHQUFHQyxPQUFPb0QsTUFBTXRDLEtBQUssTUFBUWYsR0FBR2lELE1BQU1NLElBQzNEeEMsS0FBSyxJQUFLdUMsV0FBV3RELEdBQUdDLE9BQU9vRCxNQUFNdEMsS0FBSyxNQUFRZixHQUFHaUQsTUFBTU8sSUFHcEUsUUFBU2xDLEdBQVF5QixHQUNiLEdBQUlVLEdBQUt6RCxHQUFHQyxPQUFPb0QsTUFDZkssRUFBT0MsS0FBS0MsTUFBTXhCLEVBQU95QixPQUFPSixFQUFHMUMsS0FBSyxPQUN4QytDLEVBQVFMLEVBQUcxQyxLQUFLLElBRWhCMkMsSUFBUXBFLEVBQUtpQixNQUFNUixTQUNuQjJELEVBQU9wRSxFQUFLaUIsTUFBTVIsT0FBUyxHQUVwQixFQUFQMkQsSUFDQUEsRUFBTyxHQUVYRCxFQUFHMUMsS0FBSyxJQUFLcUIsRUFBT3NCLElBQ3BCWCxFQUFFVyxLQUFPQSxFQUNUWCxFQUFFZSxNQUFRQyxLQUFLQyxNQUFNbEMsRUFBTytCLE9BQU9DLElBQ25DZixFQUFFa0IsSUFBTUYsS0FBS0MsTUFBTWxDLEVBQU8rQixPQUFPUCxXQUFXRyxFQUFHMUMsS0FBSyxVQUFZdUMsV0FBV1EsS0FHL0UsUUFBUzFDLEtBQ0xwQixHQUFHaUQsTUFBTWlCLFlBQVlDLGtCQUd6QixRQUFTQyxHQUFhQyxFQUFRQyxHQUMxQixHQUFJQyxFQUVKLEtBQUtBLElBQUtELEdBQ0ZELEVBQU9HLGVBQWVELEtBQ2xCdEYsRUFBTUMsS0FBS29GLEVBQVNDLE1BQVFuRixFQUM1QmdGLEVBQWFDLEVBQU9FLEdBQUlELEVBQVNDLElBR2pDRixFQUFPRSxHQUFLRCxFQUFTQyxJQU1yQyxRQUFTRSxHQUFXQyxHQUNoQixNQUFLNUUsV0FBVUMsUUFDZm1CLEVBQUtmLEdBQUcsWUFBYSxFQUFpQmlCLEVBQVksTUFDN0NqQixHQUFHLE9BQVEsRUFBaUJrQixFQUFXLE1BQ3ZDbEIsR0FBRyxVQUFXLEVBQWlCbUIsRUFBVSxNQUM5Q2hDLEVBQUtvRixhQUFlQSxFQUNiL0UsR0FMdUJMLEVBQUtvRixhQVF2QyxRQUFTQyxHQUFjM0IsR0FDbkIsTUFBS2xELFdBQVVDLFFBQ2ZULEVBQUswRCxnQkFBa0JBLEVBQ3ZCNEIsSUFDT2pGLEdBSHVCTCxFQUFLMEQsZ0JBTXZDLFFBQVM2QixHQUFXQyxHQUNoQixNQUFLaEYsV0FBVUMsUUFDZjhDLEVBQUsxQyxHQUFHLE9BQVEsRUFBaUJ5RSxFQUFTLE1BQzFDdEYsRUFBS3dGLGFBQWVBLEVBQ2JuRixHQUh1QkwsRUFBS3dGLGFBTXZDLFFBQVNDLEtBQ0wsTUFBUS9FLElBQUdnRixJQUFJMUYsRUFBS0MsTUFBTyxTQUFTd0QsR0FBSyxNQUFPQSxHQUFFVyxPQUFVLEdBQU0sRUFHdEUsUUFBU2pELEtBQ0wsTUFBT25CLEdBQUswQixNQUFRMUIsRUFBS2tDLE9BQU95RCxNQUFRM0YsRUFBS2tDLE9BQU9DLEtBR3hELFFBQVNkLEtBQ0wsTUFBT3JCLEdBQUsyQixPQUFTM0IsRUFBS2tDLE9BQU9FLElBQU1wQyxFQUFLa0MsT0FBTzBELE9BR3ZELFFBQVNoRCxLQUNMLE9BQ0lsQyxHQUFHbUYsSUFBSTdGLEVBQUtDLE1BQU8sU0FBU3dELEdBQUssTUFBT0EsR0FBRWUsUUFDMUM5RCxHQUFHZ0YsSUFBSTFGLEVBQUtDLE1BQU8sU0FBU3dELEdBQUssTUFBT0EsR0FBRWtCLE9BSWxELFFBQVNiLEtBQ0x4QixFQUFXd0QsYUFDTkMsU0FBUyxLQUNUeEQsTUFBTSxVQUFXLEdBQ2pCQSxNQUFNLFVBQVcsUUFHMUIsUUFBU3RDLEdBQU1SLEdBQ1gsR0FBSUMsR0FBWUMsRUFBTUMsS0FBS0gsRUFFM0IsT0FBS2UsV0FBVUMsUUFDWGYsSUFBY0csR0FBTUUsRUFBVyx3QkFBMEJMLEdBQzdETSxFQUFLQyxNQUFRUixFQUViVyxJQUNPQyxHQUx1QkwsRUFBS0MsTUFRdkMsUUFBU2dCLEdBQU0rRSxHQUNYLEdBQUlDLEdBQVl0RyxFQUFNQyxLQUFLb0csRUFDM0IsT0FBS3hGLFdBQVVDLFFBQ1h3RixJQUFjcEcsR0FBTUUsRUFBVyx3QkFBMEJrRyxHQUM3RGpHLEVBQUtpQixNQUFRK0UsRUFDYmhHLEVBQUtpQixNQUFNUixPQUFTZ0YsS0FBbUJ6RixFQUFLaUIsTUFBTVIsT0FDbER5RixHQUFlbEcsRUFBS21HLGlCQUNwQkQsR0FBZWxHLEVBQUttRyxpQkFDYjlGLEdBTnVCTCxFQUFLaUIsTUFTdkMsUUFBU2lCLEdBQU9rRSxHQUNaLEdBQUlDLEdBQU0sMERBQ1YsT0FBSzdGLFdBQVVDLFFBQ082RixTQUFsQkYsRUFBVWhFLE1BQ05tRSxNQUFNSCxFQUFVaEUsTUFBTXJDLEVBQVcsUUFBVXNHLEdBQy9DckcsRUFBS2tDLE9BQU9FLElBQU1vRSxTQUFTSixFQUFVaEUsS0FDckNILEVBQUtSLEtBQUssWUFBYSxhQUFlekIsRUFBS2tDLE9BQU9DLEtBQU8sSUFBTW5DLEVBQUtrQyxPQUFPRSxJQUFNLE1BRTdEa0UsU0FBcEJGLEVBQVVULFFBQ05ZLE1BQU1ILEVBQVVULFFBQVE1RixFQUFXLFVBQVlzRyxHQUNuRHJHLEVBQUtrQyxPQUFPeUQsTUFBUWEsU0FBU0osRUFBVVQsUUFFbEJXLFNBQXJCRixFQUFVUixTQUNOVyxNQUFNSCxFQUFVUixTQUFTN0YsRUFBVyxXQUFhc0csR0FDckRyRyxFQUFLa0MsT0FBTzBELE9BQVNZLFNBQVNKLEVBQVVSLFNBRXJCVSxTQUFuQkYsRUFBVWpFLE9BQ05vRSxNQUFNSCxFQUFVakUsT0FBT3BDLEVBQVcsU0FBV3NHLEdBQ2pEckcsRUFBS2tDLE9BQU9DLEtBQU9xRSxTQUFTSixFQUFVakUsTUFDdENGLEVBQUtSLEtBQUssWUFBYSxhQUFlekIsRUFBS2tDLE9BQU9DLEtBQU8sSUFBTW5DLEVBQUtrQyxPQUFPRSxJQUFNLE1BR3JGdEIsSUFDT1QsR0FyQnVCTCxFQUFLa0MsT0F3QnZDLFFBQVM5QixLQUNMLEdBQUlZLEdBQWF5RSxHQUNqQnpGLEdBQUtpQixNQUFNUixPQUFTTyxFQUNwQndCLEVBQU9HLE9BQU9DLEtBQ2RTLEVBQU1ELE1BQU1wQyxHQUNaOEIsRUFBT0gsUUFBUSxFQUFHM0IsSUFDbEJ1QyxFQUFLQyxFQUFFaEIsR0FDUDhDLElBR0osUUFBU0EsS0FDTCxHQUNJbUIsR0FEQUMsRUFBYXJGLEtBQXFCckIsRUFBS2lCLE1BQU1SLFFBQVUsSUFBTVQsRUFBSzJHLFVBQVksRUFHbEZGLEdBQVFwRSxFQUFVdUUsVUFBVSxRQUN2QkMsS0FBSzdHLEVBQUtDLE1BQU8sU0FBVXdELEdBQUssTUFBT0EsR0FBRXFELEtBQ3pDckYsS0FBSyxJQUFLLFNBQVVnQyxHQUFLLE1BQU9qQixHQUFPaUIsRUFBRWUsU0FDekMvQyxLQUFLLElBQUssU0FBVWdDLEdBQ2pCLE1BQVF6RCxHQUFLMkcsU0FBVyxFQUFLN0QsRUFBT1csRUFBRVcsTUFBUXRCLEVBQU9XLEVBQUVXLE1BQVFYLEVBQUVzRCxRQUFRTCxJQUU1RWpGLEtBQUssUUFBUyxTQUFVZ0MsR0FBSyxNQUFPakIsR0FBT2lCLEVBQUVrQixLQUFPbkMsRUFBT2lCLEVBQUVlLFNBQzdEL0MsS0FBSyxTQUFVLFNBQVVnQyxHQUFLLE1BQU9pRCxLQUNyQzlHLEtBQUtnQyxHQUNMZixHQUFHLFFBQVViLEVBQW9CLGdCQUFJZ0gsRUFBYyxNQUN4RFAsRUFBTVEsUUFBUXpGLE9BQU8sUUFDaEJDLEtBQUssUUFBUyxTQUFVZ0MsR0FBSyxNQUFPQSxHQUFBQSxTQUFVLFVBQzlDaEMsS0FBSyxJQUFLLFNBQVVnQyxHQUFLLE1BQU9qQixHQUFPaUIsRUFBRWUsU0FDekMvQyxLQUFLLElBQUssU0FBVWdDLEdBQ2pCLE1BQVF6RCxHQUFLMkcsU0FBVyxFQUFLN0QsRUFBT1csRUFBRVcsTUFBUXRCLEVBQU9XLEVBQUVXLE1BQVFYLEVBQUVzRCxRQUFRTCxJQUU1RWpGLEtBQUssUUFBUyxTQUFVZ0MsR0FBSyxNQUFPakIsR0FBT2lCLEVBQUVrQixLQUFPbkMsRUFBT2lCLEVBQUVlLFNBQzdEL0MsS0FBSyxTQUFVLFNBQVVnQyxHQUFLLE1BQVFpRCxLQUN0Q2pGLEtBQUssVUFBVyxLQUNoQjdCLEtBQUtnQyxHQUNMZixHQUFHLFFBQVViLEVBQW9CLGdCQUFJZ0gsRUFBYyxNQUN4RFAsRUFBTVMsT0FBT0MsU0FFYmxGLEVBQUt0QixPQUFPLG9CQUFvQmYsS0FBS29ELEdBQ3JDZixFQUFLdEIsT0FBTyxvQkFBb0JmLEtBQUt5RCxHQUVyQ1MsSUFHSixRQUFTaEQsS0FDRGQsRUFBS08sZUFDTFAsRUFBSzBCLE1BQVE4RSxTQUFTOUYsR0FBR0MsT0FBT1gsRUFBS3VCLFVBQVVnQixNQUFNLFVBQ3JEdkMsRUFBSzJCLE9BQVM2RSxTQUFTOUYsR0FBR0MsT0FBT1gsRUFBS3VCLFVBQVVnQixNQUFNLFdBRTFELElBQUlyQixHQUFjQyxJQUNkQyxFQUFlQyxHQUVuQm1CLEdBQU9LLE9BQU8sRUFBRzNCLElBQ2pCNEIsRUFBT0QsT0FBTyxFQUFHekIsSUFDakJFLEVBQU1HLEtBQUssUUFBU3pCLEVBQUswQixPQUN6QkosRUFBTUcsS0FBSyxTQUFVekIsRUFBSzJCLFFBQzFCTCxFQUFNWCxPQUFPLFFBQVFBLE9BQU8sWUFBWUEsT0FBTyxRQUFRYyxLQUFLLFFBQVNQLEdBQ3JFSSxFQUFNWCxPQUFPLFFBQVFBLE9BQU8sWUFBWUEsT0FBTyxRQUFRYyxLQUFLLFNBQVVQLEdBQ3RFZSxFQUFLUixLQUFLLFFBQVNQLEdBQ25CZSxFQUFLUixLQUFLLFNBQVVMLEdBRXBCYSxFQUFLdEIsT0FBTyxvQkFDUGMsS0FBSyxZQUFhLGVBQWlCSixJQUFvQixLQUU1RFksRUFBS3RCLE9BQU8sZ0JBQ1BpRyxVQUFVLGFBQ1ZDLEtBQUs3RyxFQUFLaUIsT0FDVlEsS0FBSyxJQUFLLFNBQVNnQyxFQUFHMkQsR0FBSSxNQUFPdEUsR0FBT3NFLEVBQUksTUFFakQ3RCxFQUFLQyxFQUFFaEIsR0FFUDZFLEVBQVVySCxFQUFLc0gsYUFDZkMsRUFBVXZILEVBQUtzSCxhQUVmaEMsSUFHSixRQUFTWSxHQUFjQyxHQUNuQixNQUFLM0YsV0FBVUMsUUFDZlQsRUFBS21HLGdCQUFrQkEsRUFDbkJBLEtBQW9CLEVBQ3BCbEUsRUFBSzJFLFVBQVUsYUFBYU8sU0FHNUJsRixFQUFLdEIsT0FBTyxnQkFBZ0JpRyxVQUFVLGFBQ2pDQyxLQUFLN0csRUFBS2lCLE9BQ1ZnRyxRQUFRekYsT0FBTyxRQUNmZ0csS0FBSyxTQUFTL0QsR0FBSSxNQUFPQSxLQUN6QmhDLEtBQUssS0FBTXpCLEVBQUtrQyxPQUFPeUQsT0FDdkJsRSxLQUFLLElBQUssU0FBU2dDLEVBQUcyRCxHQUFJLE1BQU90RSxHQUFPc0UsRUFBSSxNQUM1QzNGLEtBQUssS0FBTSxRQUNYQSxLQUFLLGNBQWUsU0FDcEJBLEtBQUssUUFBUyxZQUdoQnBCLEdBakJ1QkwsRUFBS21HLGdCQW9CdkMsUUFBU2EsR0FBWXZELEdBQ2IvQyxHQUFHaUQsTUFBTThELG1CQUNibkYsRUFBV0MsTUFBTSxVQUFXLFNBQ3ZCdUQsYUFDQUMsU0FBUyxLQUNUeEQsTUFBTSxVQUFXLElBQ3RCRCxFQUFXb0YsS0FBMkIsa0JBQWRqRSxHQUFFa0UsUUFBMEJsRSxFQUFFa0UsVUFBWWxFLEVBQUVrRSxTQUMvRHBGLE1BQU0sT0FBUzdCLEdBQUdpRCxNQUFXLE1BQUksTUFDakNwQixNQUFNLE1BQVE3QixHQUFHaUQsTUFBVyxNQUFJLE9BR3pDLFFBQVMwRCxHQUFVTyxHQUNmLElBQUtwSCxVQUFVQyxPQUFRLE1BQU9ULEdBQUs0SCxXQUNuQyxJQUFJakcsR0FBVWlHLEtBQWdCLEdBQVV2RyxJQUFvQixFQUk1RCxPQUhBMkIsR0FBTTZFLFNBQVNsRyxFQUFRLEVBQUcsR0FDMUIzQixFQUFLNEgsWUFBY0EsRUFDbkIzRixFQUFLdEIsT0FBTyxvQkFBb0JmLEtBQUtvRCxHQUM5QjNDLEVBR1gsUUFBU2tILEdBQVVELEdBQ2YsSUFBSzlHLFVBQVVDLE9BQVEsTUFBT1QsR0FBS3NILFdBQ25DLElBQUk1RixHQUFTNEYsS0FBZ0IsR0FBVW5HLElBQW1CLEVBSTFELE9BSEFrQyxHQUFNd0UsU0FBU25HLEVBQU8sRUFBRyxHQUN6QjFCLEVBQUtzSCxZQUFjQSxFQUNuQnJGLEVBQUt0QixPQUFPLG9CQUFvQmYsS0FBS3lELEdBQzlCaEQsRUFHWCxRQUFTeUgsR0FBS3BHLEVBQU9DLEdBQ2pCLE1BQUtuQixXQUFVQyxRQUNmVCxFQUFLMEIsTUFBUThFLFNBQVM5RSxJQUFVMUIsRUFBSzBCLE1BQ3JDMUIsRUFBSzJCLE9BQVM2RSxTQUFTN0UsSUFBVzNCLEVBQUsyQixPQUN2Q3JCLEdBQVcsR0FDWFEsSUFDT1QsSUFMd0JMLEVBQUswQixNQUFPMUIsRUFBSzJCLFFBUXBELFFBQVNnRixHQUFTb0IsR0FDZCxNQUFLdkgsV0FBVUMsUUFDZlQsRUFBSzJHLFNBQVdvQixFQUNoQnpDLElBQ09qRixHQUh1QkwsRUFBSzJHLFNBTXZDLFFBQVM1RyxHQUFXc0csR0FDaEIsS0FBTTJCLFdBQVUzQixHQXJjcEIsR0FBSWhHLEdBS0FpQixFQUFPTSxFQUFNSyxFQUFNSSxFQUFXQyxFQUFZVSxFQUFPUixFQUFRYSxFQUFPUCxFQUFRUyxFQUp4RXZELEtBQ0FMLEVBQVFzSSxPQUFPQyxVQUFVQyxTQUN6QnRJLEVBQU8saUJBQ1BDLEVBQU8saUJBb2NYLE9BamNBTyxJQUNJYixTQUFVQSxFQUNWYyxXQUFZQSxFQUNaNkUsV0FBWUEsRUFDWkUsY0FBZUEsRUFDZkUsV0FBWUEsRUFDWmpFLE1BQU8sV0FBYSxNQUFPVyxJQUMzQkwsS0FBTSxXQUFhLE1BQU9BLElBQzFCM0IsTUFBT0EsRUFDUGdCLE1BQU9BLEVBQ1BpQixPQUFRQSxFQUNSZ0UsY0FBZUEsRUFDZm1CLFVBQVdBLEVBQ1hFLFVBQVdBLEVBQ1hPLEtBQU1BLEVBQ05uQixTQUFVQSxFQUNWMUQsSUFBSyxXQUFhLE1BQU8zQixJQUN6QmdFLE9BQVFBLEVBQ1IvRCxTQUFVLFdBQWEsTUFBT3ZCLEdBQUt1QixVQUNuQ1QsT0FBUUEsRUFDUmtDLE1BQU8sV0FBYSxNQUFPQSxJQUMzQlIsT0FBUSxXQUFhLE1BQU9BLElBQzVCTSxPQUFRLFdBQWEsTUFBT0EsSUFDNUJPLE1BQU8sV0FBYSxNQUFPQSxJQUMzQkUsS0FBTSxXQUFhLE1BQU9BLEtBRzlCdkQsRUFBS0MsTUFBUSxLQUNiRCxFQUFLaUIsTUFBUSxLQUNiakIsRUFBS3VCLFNBQVcsZUFDaEJ2QixFQUFLMkcsU0FBVyxFQUVoQjNHLEVBQUtPLGNBQWUsRUFDcEJQLEVBQUtvRixjQUFlLEVBQ3BCcEYsRUFBSzBELGlCQUFrQixFQUN2QjFELEVBQUt3RixjQUFlLEVBQ3BCeEYsRUFBSzRILGFBQWMsRUFDbkI1SCxFQUFLc0gsYUFBYyxFQUNuQnRILEVBQUttRyxpQkFBa0IsRUFFdkJuRyxFQUFLMkIsT0FBUyxLQUNkM0IsRUFBSzBCLE1BQVEsS0FDYjFCLEVBQUtrQyxRQUNERSxJQUFLLEdBQ0x1RCxNQUFPLEdBQ1BDLE9BQVEsR0FDUnpELEtBQU0sSUFHVixXQUNJMkMsRUFBYTlFLEVBQU1ULEdBRW5CUyxFQUFLQyxNQUFRRCxFQUFLQyxVQUNsQkQsRUFBS2lCLE1BQVFqQixFQUFLaUIsVUFDbEJqQixFQUFLaUIsTUFBTVIsT0FBU2dGLElBRUEsT0FBaEJ6RixFQUFLMkIsU0FBaUIzQixFQUFLMkIsT0FBUzZFLFNBQVM5RixHQUFHQyxPQUFPWCxFQUFLdUIsVUFBVWdCLE1BQU0sWUFBYyxLQUMzRSxPQUFmdkMsRUFBSzBCLFFBQWdCMUIsRUFBSzBCLE1BQVE4RSxTQUFTOUYsR0FBR0MsT0FBT1gsRUFBS3VCLFVBQVVnQixNQUFNLFdBQWEsS0FFM0Z4QixJQUNBVCxFQUFXTixFQUFLTyxjQUNoQjRFLEVBQVduRixFQUFLb0YsY0FDaEJDLEVBQWNyRixFQUFLMEQsaUJBQ25CNkIsRUFBV3ZGLEVBQUt3RixjQUNoQlUsRUFBY2xHLEVBQUswRCxpQkFDbkIyRCxFQUFVckgsRUFBSzRILGFBQ2ZMLEVBQVV2SCxFQUFLc0gsYUFDZmhDLE9BOFhHakYiLCJmaWxlIjoiZ2FudHQtY2hhcnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FudHRDaGFydCA9IGZ1bmN0aW9uKGNvbmYpIHtcbiAgICB2YXIgYXBpLFxuICAgICAgICBzZWxmID0ge30sXG4gICAgICAgIHRvU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcbiAgICAgICAgYXN0ciA9IFwiW29iamVjdCBBcnJheV1cIixcbiAgICAgICAgb3N0ciA9IFwiW29iamVjdCBPYmplY3RdXCIsXG4gICAgICAgIGNoYXJ0LCBkcmFnLCBtYWluLCBpdGVtUmVjdHMsIHRvb2x0aXBEaXYsIHhBeGlzLCB4U2NhbGUsIHlBeGlzLCB5U2NhbGUsIHpvb207XG5cbiAgICBhcGkgPSB7XG4gICAgICAgIGFkZEl0ZW1zOiBhZGRJdGVtcyxcbiAgICAgICAgYXV0b3Jlc2l6ZTogYXV0b3Jlc2l6ZSxcbiAgICAgICAgZW5hYmxlRHJhZzogZW5hYmxlRHJhZyxcbiAgICAgICAgZW5hYmxlVG9vbHRpcDogZW5hYmxlVG9vbHRpcCxcbiAgICAgICAgZW5hYmxlWm9vbTogZW5hYmxlWm9vbSxcbiAgICAgICAgY2hhcnQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbWFpbiB9LFxuICAgICAgICBkcmFnOiBmdW5jdGlvbigpIHsgcmV0dXJuIGRyYWcgfSxcbiAgICAgICAgaXRlbXM6IGl0ZW1zLFxuICAgICAgICBsYW5lczogbGFuZXMsXG4gICAgICAgIG1hcmdpbjogbWFyZ2luLFxuICAgICAgICBzaG93TGFuZUxhYmVsOiBzaG93TGFuZUxhYmVsLFxuICAgICAgICBzaG93WEdyaWQ6IHNob3dYR3JpZCxcbiAgICAgICAgc2hvd1lHcmlkOiBzaG93WUdyaWQsXG4gICAgICAgIHNpemU6IHNpemUsXG4gICAgICAgIHN1YmxhbmVzOiBzdWJsYW5lcyxcbiAgICAgICAgc3ZnOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNoYXJ0IH0sXG4gICAgICAgIHJlZHJhdzogcmVkcmF3LFxuICAgICAgICByZW5kZXJUbzogZnVuY3Rpb24oKSB7IHJldHVybiBzZWxmLnJlbmRlclRvIH0sXG4gICAgICAgIHJlc2l6ZTogcmVzaXplLFxuICAgICAgICB4QXhpczogZnVuY3Rpb24oKSB7IHJldHVybiB4QXhpcyB9LFxuICAgICAgICB4U2NhbGU6IGZ1bmN0aW9uKCkgeyByZXR1cm4geFNjYWxlIH0sXG4gICAgICAgIHlTY2FsZTogZnVuY3Rpb24oKSB7IHJldHVybiB5U2NhbGUgfSxcbiAgICAgICAgeUF4aXM6IGZ1bmN0aW9uKCkgeyByZXR1cm4geUF4aXMgfSxcbiAgICAgICAgem9vbTogZnVuY3Rpb24oKSB7IHJldHVybiB6b29tIH0sXG4gICAgfTtcblxuICAgIHNlbGYuaXRlbXMgPSBudWxsO1xuICAgIHNlbGYubGFuZXMgPSBudWxsO1xuICAgIHNlbGYucmVuZGVyVG8gPSAnI2dhbnR0X2NoYXJ0JztcbiAgICBzZWxmLnN1YmxhbmVzID0gMTtcblxuICAgIHNlbGYuaXNBdXRvUmVzaXplID0gdHJ1ZTtcbiAgICBzZWxmLmlzRW5hYmxlRHJhZyA9IHRydWU7XG4gICAgc2VsZi5pc0VuYWJsZVRvb2x0aXAgPSB0cnVlO1xuICAgIHNlbGYuaXNFbmFibGVab29tID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1hHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1lHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd0xhbmVMYWJlbCA9IHRydWU7XG5cbiAgICBzZWxmLmhlaWdodCA9IG51bGw7XG4gICAgc2VsZi53aWR0aCA9IG51bGw7XG4gICAgc2VsZi5tYXJnaW4gPSB7XG4gICAgICAgIHRvcDogMjAsXG4gICAgICAgIHJpZ2h0OiAxNSxcbiAgICAgICAgYm90dG9tOiAyMCxcbiAgICAgICAgbGVmdDogMjBcbiAgICB9O1xuXG4gICAgKGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGNvcHlTYW1lUHJvcChzZWxmLCBjb25mKTtcblxuICAgICAgICBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcyB8fCBbXTtcbiAgICAgICAgc2VsZi5sYW5lcyA9IHNlbGYubGFuZXMgfHwgW107XG4gICAgICAgIHNlbGYubGFuZXMubGVuZ3RoID0gZ2V0TGFuZUxlbmd0aCgpO1xuXG4gICAgICAgIGlmIChzZWxmLmhlaWdodCA9PT0gbnVsbCkgc2VsZi5oZWlnaHQgPSBwYXJzZUludChkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbykuc3R5bGUoJ2hlaWdodCcpKSB8fCA0ODA7XG4gICAgICAgIGlmIChzZWxmLndpZHRoID09PSBudWxsKSBzZWxmLndpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KHNlbGYucmVuZGVyVG8pLnN0eWxlKCd3aWR0aCcpKSB8fCA2NDA7XG5cbiAgICAgICAgYnVpbGQoKTtcbiAgICAgICAgYXV0b3Jlc2l6ZShzZWxmLmlzQXV0b1Jlc2l6ZSk7XG4gICAgICAgIGVuYWJsZURyYWcoc2VsZi5pc0VuYWJsZURyYWcpO1xuICAgICAgICBlbmFibGVUb29sdGlwKHNlbGYuaXNFbmFibGVUb29sdGlwKTtcbiAgICAgICAgZW5hYmxlWm9vbShzZWxmLmlzRW5hYmxlWm9vbSk7XG4gICAgICAgIHNob3dMYW5lTGFiZWwoc2VsZi5pc0VuYWJsZVRvb2x0aXApO1xuICAgICAgICBzaG93WEdyaWQoc2VsZi5pc1Nob3dYR3JpZCk7XG4gICAgICAgIHNob3dZR3JpZChzZWxmLmlzU2hvd1lHcmlkKTtcbiAgICAgICAgcmVkcmF3KCk7XG4gICAgfSkoKTtcblxuICAgIGZ1bmN0aW9uIGFkZEl0ZW1zKG5ld0l0ZW1zKSB7XG4gICAgICAgIHZhciBpdGVtc1R5cGUgPSB0b1N0ci5jYWxsKG5ld0l0ZW1zKTtcbiAgICAgICAgaWYgKGl0ZW1zVHlwZSAhPT0gYXN0ciAmJiBpdGVtc1R5cGUgIT09IG9zdHIpIHRocm93RXJyb3IoJ0V4cGVjdGVkIG9iamVjdCBvciBhcnJheS4gR290OiAnICsgaXRlbXNUeXBlKTtcbiAgICAgICAgKGl0ZW1zVHlwZSA9PT0gYXN0cikgPyBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcy5jb25jYXQobmV3SXRlbXMpIDogc2VsZi5pdGVtcy5wdXNoKG5ld0l0ZW1zKTtcbiAgICAgICAgb25JdGVtc0NoYW5nZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF1dG9yZXNpemUoaXNBdXRvUmVzaXplKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNBdXRvUmVzaXplO1xuICAgICAgICBkMy5zZWxlY3Qod2luZG93KS5vbigncmVzaXplJywgKGlzQXV0b1Jlc2l6ZSAhPT0gZmFsc2UpID8gcmVzaXplIDogbnVsbCk7XG4gICAgICAgIHNlbGYuaXNBdXRvUmVzaXplID0gaXNBdXRvUmVzaXplO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkKCkge1xuICAgICAgICB2YXIgbGFuZUxlbmd0aCA9IHNlbGYubGFuZXMubGVuZ3RoLFxuICAgICAgICAgICAgbWFyZ2luV2lkdGggPSBnZXRNYXJnaW5XaWR0aCgpLFxuICAgICAgICAgICAgbWFyZ2luSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCk7XG5cbiAgICAgICAgY2hhcnQgPSBkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbylcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgc2VsZi53aWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNlbGYuaGVpZ2h0KVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LWNoYXJ0XCIpO1xuXG4gICAgICAgIGNoYXJ0LmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwiY2xpcFBhdGhcIilcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbGlwXCIpXG4gICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodCk7XG5cbiAgICAgICAgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwiZHJhZ3N0YXJ0XCIsIGRyYWdzdGFydClcbiAgICAgICAgICAgIC5vbihcImRyYWdcIiwgZHJhZ21vdmUpXG4gICAgICAgICAgICAub24oXCJkcmFnZW5kXCIsIGRyYWdlbmQpO1xuXG4gICAgICAgIG1haW4gPSBjaGFydC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodClcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJtYWluXCIpO1xuXG4gICAgICAgIGl0ZW1SZWN0cyA9IG1haW4uYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGlwLXBhdGhcIiwgXCJ1cmwoI2NsaXApXCIpO1xuXG4gICAgICAgIHRvb2x0aXBEaXYgPSBkMy5zZWxlY3QoXCJib2R5XCIpLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LXRvb2x0aXBcIilcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG5cbiAgICAgICAgeFNjYWxlID0gZDMudGltZS5zY2FsZSgpXG4gICAgICAgICAgICAuZG9tYWluKGdldFRpbWVEb21haW4oKSlcbiAgICAgICAgICAgIC5yYW5nZShbMCwgbWFyZ2luV2lkdGhdKTtcblxuICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgLmRvbWFpbihbMCwgbGFuZUxlbmd0aF0pXG4gICAgICAgICAgICAucmFuZ2UoWzAsIG1hcmdpbkhlaWdodF0pO1xuXG4gICAgICAgIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcbiAgICAgICAgICAgIC5vcmllbnQoJ2JvdHRvbScpXG4gICAgICAgICAgICAudGlja3MoNSlcblxuICAgICAgICB5QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgICAgICAgICAgIC5zY2FsZSh5U2NhbGUpXG4gICAgICAgICAgICAub3JpZW50KCdsZWZ0JylcbiAgICAgICAgICAgIC50aWNrcyhsYW5lTGVuZ3RoKVxuICAgICAgICAgICAgLnRpY2tGb3JtYXQoXCJcIik7XG5cbiAgICAgICAgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKVxuICAgICAgICAgICAgLngoeFNjYWxlKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBtYXJnaW5IZWlnaHQgKyAnKScpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbWFpbiBheGlzIGRhdGUnKVxuICAgICAgICAgICAgLmNhbGwoeEF4aXMpXG5cbiAgICAgICAgbWFpbi5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ21haW4gYXhpcyBsYW5lJylcbiAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGFuZUxhYmVscycpO1xuXG4gICAgICAgIGNoYXJ0LmNhbGwoem9vbSk7XG5cbiAgICAgICAgZDMuc2VsZWN0KCdodG1sJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXNFbmFibGVUb29sdGlwKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCdzdmcgcmVjdCcpKSB7XG4gICAgICAgICAgICAgICAgaGlkZVRvb2x0aXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZHJhZ21vdmUoKSB7XG4gICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIHBhcnNlRmxvYXQoZDMuc2VsZWN0KHRoaXMpLmF0dHIoXCJ4XCIpKSArIGQzLmV2ZW50LmR4KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHBhcnNlRmxvYXQoZDMuc2VsZWN0KHRoaXMpLmF0dHIoXCJ5XCIpKSArIGQzLmV2ZW50LmR5KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRyYWdlbmQoZCkge1xuICAgICAgICB2YXIgZWwgPSBkMy5zZWxlY3QodGhpcyksXG4gICAgICAgICAgICBsYW5lID0gTWF0aC5yb3VuZCh5U2NhbGUuaW52ZXJ0KGVsLmF0dHIoXCJ5XCIpKSksXG4gICAgICAgICAgICBzdGFydCA9IGVsLmF0dHIoXCJ4XCIpO1xuXG4gICAgICAgIGlmIChsYW5lID49IHNlbGYubGFuZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBsYW5lID0gc2VsZi5sYW5lcy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsYW5lIDwgMCkge1xuICAgICAgICAgICAgbGFuZSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWwuYXR0cihcInlcIiwgeVNjYWxlKGxhbmUpKTtcbiAgICAgICAgZC5sYW5lID0gbGFuZTtcbiAgICAgICAgZC5zdGFydCA9IERhdGUucGFyc2UoeFNjYWxlLmludmVydChzdGFydCkpO1xuICAgICAgICBkLmVuZCA9IERhdGUucGFyc2UoeFNjYWxlLmludmVydChwYXJzZUZsb2F0KGVsLmF0dHIoXCJ3aWR0aFwiKSkgKyBwYXJzZUZsb2F0KHN0YXJ0KSkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRyYWdzdGFydCgpIHtcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29weVNhbWVQcm9wKGNvcHlUbywgY29weUZyb20pIHtcbiAgICAgICAgdmFyIHA7XG5cbiAgICAgICAgZm9yIChwIGluIGNvcHlGcm9tKSB7XG4gICAgICAgICAgICBpZiAoY29weVRvLmhhc093blByb3BlcnR5KHApKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRvU3RyLmNhbGwoY29weUZyb21bcF0pID09PSBvc3RyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlTYW1lUHJvcChjb3B5VG9bcF0sIGNvcHlGcm9tW3BdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlUb1twXSA9IGNvcHlGcm9tW3BdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuYWJsZURyYWcoaXNFbmFibGVEcmFnKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNFbmFibGVEcmFnO1xuICAgICAgICBkcmFnLm9uKFwiZHJhZ3N0YXJ0XCIsIChpc0VuYWJsZURyYWcpID8gZHJhZ3N0YXJ0IDogbnVsbClcbiAgICAgICAgICAgIC5vbihcImRyYWdcIiwgKGlzRW5hYmxlRHJhZykgPyBkcmFnbW92ZSA6IG51bGwpXG4gICAgICAgICAgICAub24oXCJkcmFnZW5kXCIsIChpc0VuYWJsZURyYWcpID8gZHJhZ2VuZCA6IG51bGwpO1xuICAgICAgICBzZWxmLmlzRW5hYmxlRHJhZyA9IGlzRW5hYmxlRHJhZztcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmFibGVUb29sdGlwKGlzRW5hYmxlVG9vbHRpcCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzRW5hYmxlVG9vbHRpcDtcbiAgICAgICAgc2VsZi5pc0VuYWJsZVRvb2x0aXAgPSBpc0VuYWJsZVRvb2x0aXA7XG4gICAgICAgIHJlZHJhdygpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuYWJsZVpvb20oaXNFbmFibGVab29tKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNFbmFibGVab29tO1xuICAgICAgICB6b29tLm9uKFwiem9vbVwiLCAoaXNFbmFibGVab29tKSA/IHJlZHJhdyA6IG51bGwpO1xuICAgICAgICBzZWxmLmlzRW5hYmxlWm9vbSA9IGlzRW5hYmxlWm9vbTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRMYW5lTGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gKGQzLm1heChzZWxmLml0ZW1zLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmxhbmUgfSkgKyAxKSB8fCAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1hcmdpbldpZHRoKCkge1xuICAgICAgICByZXR1cm4gc2VsZi53aWR0aCAtIHNlbGYubWFyZ2luLnJpZ2h0IC0gc2VsZi5tYXJnaW4ubGVmdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRNYXJnaW5IZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmhlaWdodCAtIHNlbGYubWFyZ2luLnRvcCAtIHNlbGYubWFyZ2luLmJvdHRvbTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUaW1lRG9tYWluKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgZDMubWluKHNlbGYuaXRlbXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3RhcnQgfSksXG4gICAgICAgICAgICBkMy5tYXgoc2VsZi5pdGVtcywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5lbmQgfSlcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlVG9vbHRpcCgpIHtcbiAgICAgICAgdG9vbHRpcERpdi50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbig1MDApXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpdGVtcyhuZXdJdGVtcykge1xuICAgICAgICB2YXIgaXRlbXNUeXBlID0gdG9TdHIuY2FsbChuZXdJdGVtcyk7XG5cbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pdGVtcztcbiAgICAgICAgaWYgKGl0ZW1zVHlwZSAhPT0gYXN0cikgdGhyb3dFcnJvcignRXhwZWN0ZWQgYXJyYXkuIEdvdDogJyArIGl0ZW1zVHlwZSk7XG4gICAgICAgIHNlbGYuaXRlbXMgPSBuZXdJdGVtcztcblxuICAgICAgICBvbkl0ZW1zQ2hhbmdlKCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGFuZXMobmV3TGFuZXMpIHtcbiAgICAgICAgdmFyIGxhbmVzVHlwZSA9IHRvU3RyLmNhbGwobmV3TGFuZXMpO1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmxhbmVzO1xuICAgICAgICBpZiAobGFuZXNUeXBlICE9PSBhc3RyKSB0aHJvd0Vycm9yKCdFeHBlY3RlZCBhcnJheS4gR290OiAnICsgbGFuZXNUeXBlKTtcbiAgICAgICAgc2VsZi5sYW5lcyA9IG5ld0xhbmVzO1xuICAgICAgICBzZWxmLmxhbmVzLmxlbmd0aCA9IGdldExhbmVMZW5ndGgoKSB8fCBzZWxmLmxhbmVzLmxlbmd0aDtcbiAgICAgICAgc2hvd0xhbmVMYWJlbCghc2VsZi5pc1Nob3dMYW5lTGFiZWwpO1xuICAgICAgICBzaG93TGFuZUxhYmVsKCFzZWxmLmlzU2hvd0xhbmVMYWJlbCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFyZ2luKG5ld01hcmdpbikge1xuICAgICAgICB2YXIgbXNnID0gXCIgbWFyZ2luIHZhbHVlIGlzIGluY29ycmVjdC4gQWxsIHZhbHVlcyBzaG91bGQgYmUgbnVtYmVyc1wiO1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLm1hcmdpbjtcbiAgICAgICAgaWYgKG5ld01hcmdpbi50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld01hcmdpbi50b3ApKSB0aHJvd0Vycm9yKFwiJ1RvcCdcIiArIG1zZyk7XG4gICAgICAgICAgICBzZWxmLm1hcmdpbi50b3AgPSBwYXJzZUludChuZXdNYXJnaW4udG9wKTtcbiAgICAgICAgICAgIG1haW4uYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFyZ2luLnJpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChpc05hTihuZXdNYXJnaW4ucmlnaHQpKSB0aHJvd0Vycm9yKFwiJ1JpZ2h0J1wiICsgbXNnKTtcbiAgICAgICAgICAgIHNlbGYubWFyZ2luLnJpZ2h0ID0gcGFyc2VJbnQobmV3TWFyZ2luLnJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFyZ2luLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3TWFyZ2luLmJvdHRvbSkpIHRocm93RXJyb3IoXCInQm90dG9tJ1wiICsgbXNnKTtcbiAgICAgICAgICAgIHNlbGYubWFyZ2luLmJvdHRvbSA9IHBhcnNlSW50KG5ld01hcmdpbi5ib3R0b20pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdNYXJnaW4ubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3TWFyZ2luLmxlZnQpKSB0aHJvd0Vycm9yKFwiJ0xlZnQnXCIgKyBtc2cpO1xuICAgICAgICAgICAgc2VsZi5tYXJnaW4ubGVmdCA9IHBhcnNlSW50KG5ld01hcmdpbi5sZWZ0KTtcbiAgICAgICAgICAgIG1haW4uYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc2l6ZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uSXRlbXNDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBsYW5lTGVuZ3RoID0gZ2V0TGFuZUxlbmd0aCgpO1xuICAgICAgICBzZWxmLmxhbmVzLmxlbmd0aCA9IGxhbmVMZW5ndGg7XG4gICAgICAgIHhTY2FsZS5kb21haW4oZ2V0VGltZURvbWFpbigpKTtcbiAgICAgICAgeUF4aXMudGlja3MobGFuZUxlbmd0aCk7XG4gICAgICAgIHlTY2FsZS5kb21haW4oWzAsIGxhbmVMZW5ndGhdKTtcbiAgICAgICAgem9vbS54KHhTY2FsZSk7XG4gICAgICAgIHJlZHJhdygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlZHJhdygpIHtcbiAgICAgICAgdmFyIGl0ZW1IZWlnaHQgPSBnZXRNYXJnaW5IZWlnaHQoKSAvIChzZWxmLmxhbmVzLmxlbmd0aCB8fCAxKSAvIChzZWxmLnN1YmxhbmVzIHx8IDEpLFxuICAgICAgICAgICAgcmVjdHM7XG5cbiAgICAgICAgcmVjdHMgPSBpdGVtUmVjdHMuc2VsZWN0QWxsKFwicmVjdFwiKVxuICAgICAgICAgICAgLmRhdGEoc2VsZi5pdGVtcywgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIGQuaWQ7IH0pXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLnN0YXJ0KTsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoc2VsZi5zdWJsYW5lcyA8IDIpID8geVNjYWxlKGQubGFuZSkgOiB5U2NhbGUoZC5sYW5lKSArIGQuc3VibGFuZSppdGVtSGVpZ2h0O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLmVuZCkgLSB4U2NhbGUoZC5zdGFydCk7IH0pXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gaXRlbUhlaWdodDsgfSlcbiAgICAgICAgICAgIC5jYWxsKGRyYWcpXG4gICAgICAgICAgICAub24oXCJjbGlja1wiLCAoc2VsZi5pc0VuYWJsZVRvb2x0aXApID8gc2hvd1Rvb2x0aXAgOiBudWxsKTtcbiAgICAgICAgcmVjdHMuZW50ZXIoKS5hcHBlbmQoXCJyZWN0XCIpXG4gICAgICAgICAgICAuYXR0cihcImNsYXNzXCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmNsYXNzICsgJyBtYWluJzsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGQuc3RhcnQpOyB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChzZWxmLnN1YmxhbmVzIDwgMikgPyB5U2NhbGUoZC5sYW5lKSA6IHlTY2FsZShkLmxhbmUpICsgZC5zdWJsYW5lKml0ZW1IZWlnaHQ7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4geFNjYWxlKGQuZW5kKSAtIHhTY2FsZShkLnN0YXJ0KTsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIGZ1bmN0aW9uIChkKSB7IHJldHVybiAgaXRlbUhlaWdodDsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwib3BhY2l0eVwiLCAuNzUpXG4gICAgICAgICAgICAuY2FsbChkcmFnKVxuICAgICAgICAgICAgLm9uKFwiY2xpY2tcIiwgKHNlbGYuaXNFbmFibGVUb29sdGlwKSA/IHNob3dUb29sdGlwIDogbnVsbCk7XG4gICAgICAgIHJlY3RzLmV4aXQoKS5yZW1vdmUoKTtcblxuICAgICAgICBtYWluLnNlbGVjdCgnZy5tYWluLmF4aXMuZGF0ZScpLmNhbGwoeEF4aXMpO1xuICAgICAgICBtYWluLnNlbGVjdCgnZy5tYWluLmF4aXMubGFuZScpLmNhbGwoeUF4aXMpO1xuXG4gICAgICAgIGhpZGVUb29sdGlwKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVzaXplKCkge1xuICAgICAgICBpZiAoc2VsZi5pc0F1dG9SZXNpemUpIHtcbiAgICAgICAgICAgIHNlbGYud2lkdGggPSBwYXJzZUludChkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbykuc3R5bGUoJ3dpZHRoJykpO1xuICAgICAgICAgICAgc2VsZi5oZWlnaHQgPSBwYXJzZUludChkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbykuc3R5bGUoJ2hlaWdodCcpKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbWFyZ2luV2lkdGggPSBnZXRNYXJnaW5XaWR0aCgpLFxuICAgICAgICAgICAgbWFyZ2luSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCk7XG5cbiAgICAgICAgeFNjYWxlLnJhbmdlKFswLCBtYXJnaW5XaWR0aF0pO1xuICAgICAgICB5U2NhbGUucmFuZ2UoWzAsIG1hcmdpbkhlaWdodF0pO1xuICAgICAgICBjaGFydC5hdHRyKFwid2lkdGhcIiwgc2VsZi53aWR0aCk7XG4gICAgICAgIGNoYXJ0LmF0dHIoXCJoZWlnaHRcIiwgc2VsZi5oZWlnaHQpO1xuICAgICAgICBjaGFydC5zZWxlY3QoJ2RlZnMnKS5zZWxlY3QoJ2NsaXBQYXRoJykuc2VsZWN0KCdyZWN0JykuYXR0cihcIndpZHRoXCIsIG1hcmdpbldpZHRoKTtcbiAgICAgICAgY2hhcnQuc2VsZWN0KCdkZWZzJykuc2VsZWN0KCdjbGlwUGF0aCcpLnNlbGVjdCgncmVjdCcpLmF0dHIoXCJoZWlnaHRcIiwgbWFyZ2luV2lkdGgpO1xuICAgICAgICBtYWluLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aCk7XG4gICAgICAgIG1haW4uYXR0cihcImhlaWdodFwiLCBtYXJnaW5IZWlnaHQpO1xuXG4gICAgICAgIG1haW4uc2VsZWN0KCdnLm1haW4uYXhpcy5kYXRlJylcbiAgICAgICAgICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlKDAsJyArIGdldE1hcmdpbkhlaWdodCgpICsgJyknKTtcblxuICAgICAgICBtYWluLnNlbGVjdCgnZy5sYW5lTGFiZWxzJylcbiAgICAgICAgICAgIC5zZWxlY3RBbGwoXCIubGFuZVRleHRcIilcbiAgICAgICAgICAgIC5kYXRhKHNlbGYubGFuZXMpXG4gICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCwgaSkge3JldHVybiB5U2NhbGUoaSArIC41KTt9KVxuXG4gICAgICAgIHpvb20ueCh4U2NhbGUpO1xuXG4gICAgICAgIHNob3dYR3JpZChzZWxmLmlzU2hvd1lHcmlkKTtcbiAgICAgICAgc2hvd1lHcmlkKHNlbGYuaXNTaG93WUdyaWQpO1xuXG4gICAgICAgIHJlZHJhdygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dMYW5lTGFiZWwoaXNTaG93TGFuZUxhYmVsKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNTaG93TGFuZUxhYmVsO1xuICAgICAgICBzZWxmLmlzU2hvd0xhbmVMYWJlbCA9IGlzU2hvd0xhbmVMYWJlbDtcbiAgICAgICAgaWYgKGlzU2hvd0xhbmVMYWJlbCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1haW4uc2VsZWN0QWxsKFwiLmxhbmVUZXh0XCIpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWFpbi5zZWxlY3QoJ2cubGFuZUxhYmVscycpLnNlbGVjdEFsbChcIi5sYW5lVGV4dFwiKVxuICAgICAgICAgICAgICAgIC5kYXRhKHNlbGYubGFuZXMpXG4gICAgICAgICAgICAgICAgLmVudGVyKCkuYXBwZW5kKFwidGV4dFwiKVxuICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHtyZXR1cm4gZDt9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCAtc2VsZi5tYXJnaW4ucmlnaHQpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIGZ1bmN0aW9uKGQsIGkpIHtyZXR1cm4geVNjYWxlKGkgKyAuNSk7fSlcbiAgICAgICAgICAgICAgICAuYXR0cihcImR5XCIsIFwiLjVleFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJzdGFydFwiKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJsYW5lVGV4dFwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd1Rvb2x0aXAoZCkge1xuICAgICAgICBpZiAoZDMuZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuO1xuICAgICAgICB0b29sdGlwRGl2LnN0eWxlKFwiZGlzcGxheVwiLCBcImJsb2NrXCIpXG4gICAgICAgICAgICAudHJhbnNpdGlvbigpXG4gICAgICAgICAgICAuZHVyYXRpb24oMjAwKVxuICAgICAgICAgICAgLnN0eWxlKFwib3BhY2l0eVwiLCAuOSk7XG4gICAgICAgIHRvb2x0aXBEaXYuaHRtbCgodHlwZW9mIGQudG9vbHRpcCA9PT0gJ2Z1bmN0aW9uJykgPyBkLnRvb2x0aXAoKSA6IGQudG9vbHRpcClcbiAgICAgICAgICAgIC5zdHlsZShcImxlZnRcIiwgKGQzLmV2ZW50LnBhZ2VYKSArIFwicHhcIilcbiAgICAgICAgICAgIC5zdHlsZShcInRvcFwiLCAoZDMuZXZlbnQucGFnZVkpICsgXCJweFwiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93WEdyaWQoaXNTaG93WEdyaWQpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pc1Nob3dYR3JpZDtcbiAgICAgICAgdmFyIGhlaWdodCA9IChpc1Nob3dYR3JpZCAhPT0gZmFsc2UpID8gLWdldE1hcmdpbkhlaWdodCgpIDogLTY7XG4gICAgICAgIHhBeGlzLnRpY2tTaXplKGhlaWdodCwgMCwgMCk7XG4gICAgICAgIHNlbGYuaXNTaG93WEdyaWQgPSBpc1Nob3dYR3JpZDtcbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubWFpbi5heGlzLmRhdGUnKS5jYWxsKHhBeGlzKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93WUdyaWQoaXNTaG93WUdyaWQpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pc1Nob3dZR3JpZDtcbiAgICAgICAgdmFyIHdpZHRoID0gKGlzU2hvd1lHcmlkICE9PSBmYWxzZSkgPyAtZ2V0TWFyZ2luV2lkdGgoKSA6IC02O1xuICAgICAgICB5QXhpcy50aWNrU2l6ZSh3aWR0aCwgMCwgMCk7XG4gICAgICAgIHNlbGYuaXNTaG93WUdyaWQgPSBpc1Nob3dZR3JpZDtcbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubWFpbi5heGlzLmxhbmUnKS5jYWxsKHlBeGlzKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaXplKHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gW3NlbGYud2lkdGgsIHNlbGYuaGVpZ2h0XTtcbiAgICAgICAgc2VsZi53aWR0aCA9IHBhcnNlSW50KHdpZHRoKSB8fCBzZWxmLndpZHRoO1xuICAgICAgICBzZWxmLmhlaWdodCA9IHBhcnNlSW50KGhlaWdodCkgfHwgc2VsZi5oZWlnaHQ7XG4gICAgICAgIGF1dG9yZXNpemUoZmFsc2UpO1xuICAgICAgICByZXNpemUoKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWJsYW5lcyhuZXdTdWJsYW5lcykge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLnN1YmxhbmVzO1xuICAgICAgICBzZWxmLnN1YmxhbmVzID0gbmV3U3VibGFuZXM7XG4gICAgICAgIHJlZHJhdygpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRocm93RXJyb3IobXNnKSB7XG4gICAgICAgIHRocm93IFR5cGVFcnJvcihtc2cpO1xuICAgIH1cblxuICAgIHJldHVybiBhcGk7XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
