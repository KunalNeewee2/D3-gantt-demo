"use strict";var ganttChart=function(t){function e(t){var e=M.call(t);return e!==_&&e!==q&&A("Expected object or array. Got: "+e),e===_?C.items=C.items.concat(t):C.items.push(t),y(),D}function n(t){return arguments.length?(d3.select(window).on("resize",t!==!1?z:null),C.isAutoResize=t,D):C.isAutoResize}function a(){var t=C.lanes.length,e=p(),n=m();k=d3.select(C.renderTo).append("svg").attr("width",C.width).attr("height",C.height).attr("class","gantt-chart"),k.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",e).attr("height",n),F=d3.behavior.drag().on("dragstart",l).on("drag",i).on("dragend",s),N=k.append("g").attr("transform","translate("+C.margin.left+","+C.margin.top+")").attr("width",e).attr("height",n).attr("class","main"),Y=N.append("g").attr("clip-path","url(#clip)"),P=d3.select("body").append("div").attr("class","gantt-tooltip").style("opacity",0),j=d3.time.scale().domain(f()).range([0,e]),O=d3.scale.linear().domain([0,t]).range([0,n]),X=d3.svg.axis().scale(j).orient("bottom").ticks(5),Z=d3.svg.axis().scale(O).orient("left").ticks(t).tickFormat(""),B=d3.behavior.zoom().x(j),N.append("g").attr("transform","translate(0,"+n+")").attr("class","main axis date").call(X),N.append("g").attr("class","main axis lane").call(Z),N.append("g").attr("class","laneLabels"),k.call(B),d3.select("html").on("click",function(t){C.isEnableTooltip&&(event.target.closest("svg rect")||b())})}function r(t){var e=parseFloat(d3.select(this).attr("x")),n=parseFloat(d3.select(this).attr("width")),a=e+n;e+H>=d3.event.x||a<=d3.event.x?d3.select(this).attr("class",t["class"]+(C.isEnableItemResize?" cursor-resize":" cursor-default")):d3.select(this).attr("class",t["class"]+(C.isEnableDrag?" cursor-move":" cursor-default"))}function i(){var t=parseFloat(d3.select(this).attr("x")),e=parseFloat(d3.select(this).attr("y")),n=parseFloat(d3.select(this).attr("width")),a=t+n;if(C.isEnableItemResize){if(t+H>=d3.event.x&&a-H>=t)return void d3.select(this).attr("x",t+d3.event.dx).attr("width",n-d3.event.dx);if(a-H<=d3.event.x&&a>=t+5)return void d3.select(this).attr("width",n+d3.event.dx)}C.isEnableDrag&&d3.select(this).attr("x",t+d3.event.dx).attr("y",e+d3.event.dy)}function s(t){if(C.isEnableDrag||C.isEnableItemResize){var e=d3.select(this),n=Math.round(O.invert(e.attr("y"))),a=e.attr("x");n>=C.lanes.length&&(n=C.lanes.length-1),0>n&&(n=0),e.attr("y",O(n)),t.lane=n,t.start=Date.parse(j.invert(a)),t.end=Date.parse(j.invert(parseFloat(e.attr("width"))+parseFloat(a)))}}function l(){(C.isEnableDrag||C.isEnableItemResize)&&d3.event.sourceEvent.stopPropagation()}function o(t,e){var n;for(n in e)t.hasOwnProperty(n)&&(M.call(e[n])===q?o(t[n],e[n]):t[n]=e[n])}function c(t){return arguments.length?(C.isEnableDrag=t,E(),D):C.isEnableDrag}function d(t){return arguments.length?(C.isEnableItemResize=t,E(),D):C.isEnableItemResize}function h(t){return arguments.length?(C.isEnableTooltip=t,E(),D):C.isEnableTooltip}function u(t){return arguments.length?(B.on("zoom",t?E:null),C.isEnableZoom=t,D):C.isEnableZoom}function g(){return d3.max(C.items,function(t){return t.lane})+1||0}function p(){return C.width-C.margin.right-C.margin.left}function m(){return C.height-C.margin.top-C.margin.bottom}function f(){return[d3.min(C.items,function(t){return t.start}),d3.max(C.items,function(t){return t.end})]}function b(){P.transition().duration(500).style("opacity",0).style("display","none")}function v(t){var e=M.call(t);return arguments.length?(e!==_&&A("Expected array. Got: "+e),C.items=t,y(),D):C.items}function w(t){var e=M.call(t);return arguments.length?(e!==_&&A("Expected array. Got: "+e),C.lanes=t,C.lanes.length=g()||C.lanes.length,T(!C.isShowLaneLabel),T(!C.isShowLaneLabel),D):C.lanes}function x(t){var e=" margin value is incorrect. All values should be numbers";return arguments.length?(void 0!==t.top&&(isNaN(t.top)&&A("'Top'"+e),C.margin.top=parseInt(t.top),N.attr("transform","translate("+C.margin.left+","+C.margin.top+")")),void 0!==t.right&&(isNaN(t.right)&&A("'Right'"+e),C.margin.right=parseInt(t.right)),void 0!==t.bottom&&(isNaN(t.bottom)&&A("'Bottom'"+e),C.margin.bottom=parseInt(t.bottom)),void 0!==t.left&&(isNaN(t.left)&&A("'Left'"+e),C.margin.left=parseInt(t.left),N.attr("transform","translate("+C.margin.left+","+C.margin.top+")")),z(),D):C.margin}function y(){var t=g();C.lanes.length=t,j.domain(f()),Z.ticks(t),O.domain([0,t]),B.x(j),E(),E()}function E(){var t,e=m()/(C.lanes.length||1)/(C.sublanes||1);t=Y.selectAll("rect").data(C.items).attr("x",function(t){return j(t.start)}).attr("y",function(t){return C.sublanes<2?O(t.lane):O(t.lane)+t.sublane*e}).attr("width",function(t){return j(t.end)-j(t.start)}).attr("height",e).attr("class",function(t){return t["class"]+" main"}).attr("opacity",.75).call(F).on("click",C.isEnableTooltip?S:null).on("mousemove",r),t.enter().append("rect"),t.exit().remove(),N.select("g.main.axis.date").call(X),N.select("g.main.axis.lane").call(Z),b()}function z(){C.isAutoResize&&(C.width=parseInt(d3.select(C.renderTo).style("width")),C.height=parseInt(d3.select(C.renderTo).style("height")));var t=p(),e=m();j.range([0,t]),O.range([0,e]),k.attr("width",C.width),k.attr("height",C.height),k.select("defs").select("clipPath").select("rect").attr("width",t),k.select("defs").select("clipPath").select("rect").attr("height",t),N.attr("width",t),N.attr("height",e),N.select("g.main.axis.date").attr("transform","translate(0,"+m()+")"),N.select("g.laneLabels").selectAll(".laneText").data(C.lanes).attr("y",function(t,e){return O(e+.5)}),B.x(j),I(C.isShowYGrid),L(C.isShowYGrid),E()}function T(t){return arguments.length?(C.isShowLaneLabel=t,t===!1?N.selectAll(".laneText").remove():N.select("g.laneLabels").selectAll(".laneText").data(C.lanes).enter().append("text").text(function(t){return t}).attr("x",-C.margin.right).attr("y",function(t,e){return O(e+.5)}).attr("dy",".5ex").attr("text-anchor","start").attr("class","laneText"),D):C.isShowLaneLabel}function S(t){d3.event.defaultPrevented||(P.style("display","block").transition().duration(200).style("opacity",.9),P.html("function"==typeof t.tooltip?t.tooltip():t.tooltip).style("left",d3.event.pageX+"px").style("top",d3.event.pageY+"px"))}function I(t){if(!arguments.length)return C.isShowXGrid;var e=t!==!1?-m():-6;return X.tickSize(e,0,0),C.isShowXGrid=t,N.select("g.main.axis.date").call(X),D}function L(t){if(!arguments.length)return C.isShowYGrid;var e=t!==!1?-p():-6;return Z.tickSize(e,0,0),C.isShowYGrid=t,N.select("g.main.axis.lane").call(Z),D}function G(t,e){return arguments.length?(C.width=parseInt(t)||C.width,C.height=parseInt(e)||C.height,n(!1),z(),D):[C.width,C.height]}function R(t){return arguments.length?(C.sublanes=t,E(),D):C.sublanes}function A(t){throw TypeError(t)}var D,k,F,N,Y,P,X,j,Z,O,B,C={},M=Object.prototype.toString,_="[object Array]",q="[object Object]",H=50;return D={addItems:e,autoresize:n,enableDrag:c,enableItemResize:d,enableTooltip:h,enableZoom:u,chart:function(){return N},drag:function(){return F},items:v,lanes:w,margin:x,showLaneLabel:T,showXGrid:I,showYGrid:L,size:G,sublanes:R,svg:function(){return k},redraw:E,renderTo:function(){return C.renderTo},resize:z,xAxis:function(){return X},xScale:function(){return j},yScale:function(){return O},yAxis:function(){return Z},zoom:function(){return B}},C.items=null,C.lanes=null,C.renderTo="#gantt_chart",C.sublanes=1,C.isAutoResize=!0,C.isEnableDrag=!0,C.isEnableItemResize=!0,C.isEnableTooltip=!0,C.isEnableZoom=!0,C.isShowXGrid=!0,C.isShowYGrid=!0,C.isShowLaneLabel=!0,C.height=null,C.width=null,C.margin={top:20,right:15,bottom:20,left:20},function(){o(C,t),C.items=C.items||[],C.lanes=C.lanes||[],C.lanes.length=g(),null===C.height&&(C.height=parseInt(d3.select(C.renderTo).style("height"))||480),null===C.width&&(C.width=parseInt(d3.select(C.renderTo).style("width"))||640),a(),n(C.isAutoResize),c(C.isEnableDrag),h(C.isEnableTooltip),u(C.isEnableZoom),T(C.isEnableTooltip),I(C.isShowXGrid),L(C.isShowYGrid),E()}(),D};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdhbnR0LWNoYXJ0LmpzIl0sIm5hbWVzIjpbImdhbnR0Q2hhcnQiLCJjb25mIiwiYWRkSXRlbXMiLCJuZXdJdGVtcyIsIml0ZW1zVHlwZSIsInRvU3RyIiwiY2FsbCIsImFzdHIiLCJvc3RyIiwidGhyb3dFcnJvciIsInNlbGYiLCJpdGVtcyIsImNvbmNhdCIsInB1c2giLCJvbkl0ZW1zQ2hhbmdlIiwiYXBpIiwiYXV0b3Jlc2l6ZSIsImlzQXV0b1Jlc2l6ZSIsImFyZ3VtZW50cyIsImxlbmd0aCIsImQzIiwic2VsZWN0Iiwid2luZG93Iiwib24iLCJyZXNpemUiLCJidWlsZCIsImxhbmVMZW5ndGgiLCJsYW5lcyIsIm1hcmdpbldpZHRoIiwiZ2V0TWFyZ2luV2lkdGgiLCJtYXJnaW5IZWlnaHQiLCJnZXRNYXJnaW5IZWlnaHQiLCJjaGFydCIsInJlbmRlclRvIiwiYXBwZW5kIiwiYXR0ciIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhZyIsImJlaGF2aW9yIiwiZHJhZ3N0YXJ0IiwiZHJhZ21vdmUiLCJkcmFnZW5kIiwibWFpbiIsIm1hcmdpbiIsImxlZnQiLCJ0b3AiLCJpdGVtUmVjdHMiLCJ0b29sdGlwRGl2Iiwic3R5bGUiLCJ4U2NhbGUiLCJ0aW1lIiwic2NhbGUiLCJkb21haW4iLCJnZXRUaW1lRG9tYWluIiwicmFuZ2UiLCJ5U2NhbGUiLCJsaW5lYXIiLCJ4QXhpcyIsInN2ZyIsImF4aXMiLCJvcmllbnQiLCJ0aWNrcyIsInlBeGlzIiwidGlja0Zvcm1hdCIsInpvb20iLCJ4IiwiZCIsImlzRW5hYmxlVG9vbHRpcCIsImV2ZW50IiwidGFyZ2V0IiwiY2xvc2VzdCIsImhpZGVUb29sdGlwIiwiY2hhbmdlQ3Vyc29yIiwicGFyc2VGbG9hdCIsInRoaXMiLCJ4MSIsInJlc2l6ZVJlY3RNYXJnaW4iLCJ5IiwiaXNFbmFibGVJdGVtUmVzaXplIiwiZHgiLCJpc0VuYWJsZURyYWciLCJkeSIsImVsIiwibGFuZSIsIk1hdGgiLCJyb3VuZCIsImludmVydCIsInN0YXJ0IiwiRGF0ZSIsInBhcnNlIiwiZW5kIiwic291cmNlRXZlbnQiLCJzdG9wUHJvcGFnYXRpb24iLCJjb3B5U2FtZVByb3AiLCJjb3B5VG8iLCJjb3B5RnJvbSIsInAiLCJoYXNPd25Qcm9wZXJ0eSIsImVuYWJsZURyYWciLCJyZWRyYXciLCJlbmFibGVJdGVtUmVzaXplIiwiZW5hYmxlVG9vbHRpcCIsImVuYWJsZVpvb20iLCJpc0VuYWJsZVpvb20iLCJnZXRMYW5lTGVuZ3RoIiwibWF4IiwicmlnaHQiLCJib3R0b20iLCJtaW4iLCJ0cmFuc2l0aW9uIiwiZHVyYXRpb24iLCJuZXdMYW5lcyIsImxhbmVzVHlwZSIsInNob3dMYW5lTGFiZWwiLCJpc1Nob3dMYW5lTGFiZWwiLCJuZXdNYXJnaW4iLCJtc2ciLCJ1bmRlZmluZWQiLCJpc05hTiIsInBhcnNlSW50IiwicmVjdHMiLCJpdGVtSGVpZ2h0Iiwic3VibGFuZXMiLCJzZWxlY3RBbGwiLCJkYXRhIiwic3VibGFuZSIsInNob3dUb29sdGlwIiwiZW50ZXIiLCJleGl0IiwicmVtb3ZlIiwiaSIsInNob3dYR3JpZCIsImlzU2hvd1lHcmlkIiwic2hvd1lHcmlkIiwidGV4dCIsImRlZmF1bHRQcmV2ZW50ZWQiLCJodG1sIiwidG9vbHRpcCIsImlzU2hvd1hHcmlkIiwidGlja1NpemUiLCJzaXplIiwibmV3U3VibGFuZXMiLCJUeXBlRXJyb3IiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyJdLCJtYXBwaW5ncyI6IkFBQUEsWUFFQSxJQUFJQSxZQUFhLFNBQVNDLEdBaUZ0QixRQUFTQyxHQUFTQyxHQUNkLEdBQUlDLEdBQVlDLEVBQU1DLEtBQUtILEVBSTNCLE9BSElDLEtBQWNHLEdBQVFILElBQWNJLEdBQU1DLEVBQVcsa0NBQW9DTCxHQUM1RkEsSUFBY0csRUFBUUcsRUFBS0MsTUFBUUQsRUFBS0MsTUFBTUMsT0FBT1QsR0FBWU8sRUFBS0MsTUFBTUUsS0FBS1YsR0FDbEZXLElBQ09DLEVBR1gsUUFBU0MsR0FBV0MsR0FDaEIsTUFBS0Ms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Q2hCdkIsRUFBS2lILFNBQVcsRUFFaEJqSCxFQUFLTyxjQUFlLEVBQ3BCUCxFQUFLdUUsY0FBZSxFQUNwQnZFLEVBQUtxRSxvQkFBcUIsRUFDMUJyRSxFQUFLMEQsaUJBQWtCLEVBQ3ZCMUQsRUFBSzhGLGNBQWUsRUFDcEI5RixFQUFLaUksYUFBYyxFQUNuQmpJLEVBQUsySCxhQUFjLEVBQ25CM0gsRUFBS3lHLGlCQUFrQixFQUV2QnpHLEVBQUsyQixPQUFTLEtBQ2QzQixFQUFLMEIsTUFBUSxLQUNiMUIsRUFBS2tDLFFBQ0RFLElBQUssR0FDTDZELE1BQU8sR0FDUEMsT0FBUSxHQUNSL0QsS0FBTSxJQUdWLFdBQ0lpRCxFQUFhcEYsRUFBTVQsR0FFbkJTLEVBQUtDLE1BQVFELEVBQUtDLFVBQ2xCRCxFQUFLaUIsTUFBUWpCLEVBQUtpQixVQUNsQmpCLEVBQUtpQixNQUFNUixPQUFTc0YsSUFFQSxPQUFoQi9GLEVBQUsyQixTQUFpQjNCLEVBQUsyQixPQUFTbUYsU0FBU3BHLEdBQUdDLE9BQU9YLEVBQUt1QixVQUFVZ0IsTUFBTSxZQUFjLEtBQzNFLE9BQWZ2QyxFQUFLMEIsUUFBZ0IxQixFQUFLMEIsTUFBUW9GLFNBQVNwRyxHQUFHQyxPQUFPWCxFQUFLdUIsVUFBVWdCLE1BQU0sV0FBYSxLQUUzRnhCLElBQ0FULEVBQVdOLEVBQUtPLGNBQ2hCa0YsRUFBV3pGLEVBQUt1RSxjQUNoQnFCLEVBQWM1RixFQUFLMEQsaUJBQ25CbUMsRUFBVzdGLEVBQUs4RixjQUNoQlUsRUFBY3hHLEVBQUswRCxpQkFDbkJnRSxFQUFVMUgsRUFBS2lJLGFBQ2ZMLEVBQVU1SCxFQUFLMkgsYUFDZmpDLE9Ba2FHckYiLCJmaWxlIjoiZ2FudHQtY2hhcnQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG52YXIgZ2FudHRDaGFydCA9IGZ1bmN0aW9uKGNvbmYpIHtcbiAgICB2YXIgYXBpLFxuICAgICAgICBzZWxmID0ge30sXG4gICAgICAgIHRvU3RyID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZyxcbiAgICAgICAgYXN0ciA9IFwiW29iamVjdCBBcnJheV1cIixcbiAgICAgICAgb3N0ciA9IFwiW29iamVjdCBPYmplY3RdXCIsXG4gICAgICAgIGNoYXJ0LCBkcmFnLCBtYWluLCBpdGVtUmVjdHMsIHRvb2x0aXBEaXYsIHhBeGlzLCB4U2NhbGUsIHlBeGlzLCB5U2NhbGUsIHpvb20sXG4gICAgICAgIHJlc2l6ZVJlY3RNYXJnaW4gPSA1MDtcblxuICAgIGFwaSA9IHtcbiAgICAgICAgYWRkSXRlbXM6IGFkZEl0ZW1zLFxuICAgICAgICBhdXRvcmVzaXplOiBhdXRvcmVzaXplLFxuICAgICAgICBlbmFibGVEcmFnOiBlbmFibGVEcmFnLFxuICAgICAgICBlbmFibGVJdGVtUmVzaXplOiBlbmFibGVJdGVtUmVzaXplLFxuICAgICAgICBlbmFibGVUb29sdGlwOiBlbmFibGVUb29sdGlwLFxuICAgICAgICBlbmFibGVab29tOiBlbmFibGVab29tLFxuICAgICAgICBjaGFydDogZnVuY3Rpb24oKSB7IHJldHVybiBtYWluIH0sXG4gICAgICAgIGRyYWc6IGZ1bmN0aW9uKCkgeyByZXR1cm4gZHJhZyB9LFxuICAgICAgICBpdGVtczogaXRlbXMsXG4gICAgICAgIGxhbmVzOiBsYW5lcyxcbiAgICAgICAgbWFyZ2luOiBtYXJnaW4sXG4gICAgICAgIHNob3dMYW5lTGFiZWw6IHNob3dMYW5lTGFiZWwsXG4gICAgICAgIHNob3dYR3JpZDogc2hvd1hHcmlkLFxuICAgICAgICBzaG93WUdyaWQ6IHNob3dZR3JpZCxcbiAgICAgICAgc2l6ZTogc2l6ZSxcbiAgICAgICAgc3VibGFuZXM6IHN1YmxhbmVzLFxuICAgICAgICBzdmc6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2hhcnQgfSxcbiAgICAgICAgcmVkcmF3OiByZWRyYXcsXG4gICAgICAgIHJlbmRlclRvOiBmdW5jdGlvbigpIHsgcmV0dXJuIHNlbGYucmVuZGVyVG8gfSxcbiAgICAgICAgcmVzaXplOiByZXNpemUsXG4gICAgICAgIHhBeGlzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHhBeGlzIH0sXG4gICAgICAgIHhTY2FsZTogZnVuY3Rpb24oKSB7IHJldHVybiB4U2NhbGUgfSxcbiAgICAgICAgeVNjYWxlOiBmdW5jdGlvbigpIHsgcmV0dXJuIHlTY2FsZSB9LFxuICAgICAgICB5QXhpczogZnVuY3Rpb24oKSB7IHJldHVybiB5QXhpcyB9LFxuICAgICAgICB6b29tOiBmdW5jdGlvbigpIHsgcmV0dXJuIHpvb20gfSxcbiAgICB9O1xuXG4gICAgc2VsZi5pdGVtcyA9IG51bGw7XG4gICAgc2VsZi5sYW5lcyA9IG51bGw7XG4gICAgc2VsZi5yZW5kZXJUbyA9ICcjZ2FudHRfY2hhcnQnO1xuICAgIHNlbGYuc3VibGFuZXMgPSAxO1xuXG4gICAgc2VsZi5pc0F1dG9SZXNpemUgPSB0cnVlO1xuICAgIHNlbGYuaXNFbmFibGVEcmFnID0gdHJ1ZTtcbiAgICBzZWxmLmlzRW5hYmxlSXRlbVJlc2l6ZSA9IHRydWU7XG4gICAgc2VsZi5pc0VuYWJsZVRvb2x0aXAgPSB0cnVlO1xuICAgIHNlbGYuaXNFbmFibGVab29tID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1hHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd1lHcmlkID0gdHJ1ZTtcbiAgICBzZWxmLmlzU2hvd0xhbmVMYWJlbCA9IHRydWU7XG5cbiAgICBzZWxmLmhlaWdodCA9IG51bGw7XG4gICAgc2VsZi53aWR0aCA9IG51bGw7XG4gICAgc2VsZi5tYXJnaW4gPSB7XG4gICAgICAgIHRvcDogMjAsXG4gICAgICAgIHJpZ2h0OiAxNSxcbiAgICAgICAgYm90dG9tOiAyMCxcbiAgICAgICAgbGVmdDogMjBcbiAgICB9O1xuXG4gICAgKGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGNvcHlTYW1lUHJvcChzZWxmLCBjb25mKTtcblxuICAgICAgICBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcyB8fCBbXTtcbiAgICAgICAgc2VsZi5sYW5lcyA9IHNlbGYubGFuZXMgfHwgW107XG4gICAgICAgIHNlbGYubGFuZXMubGVuZ3RoID0gZ2V0TGFuZUxlbmd0aCgpO1xuXG4gICAgICAgIGlmIChzZWxmLmhlaWdodCA9PT0gbnVsbCkgc2VsZi5oZWlnaHQgPSBwYXJzZUludChkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbykuc3R5bGUoJ2hlaWdodCcpKSB8fCA0ODA7XG4gICAgICAgIGlmIChzZWxmLndpZHRoID09PSBudWxsKSBzZWxmLndpZHRoID0gcGFyc2VJbnQoZDMuc2VsZWN0KHNlbGYucmVuZGVyVG8pLnN0eWxlKCd3aWR0aCcpKSB8fCA2NDA7XG5cbiAgICAgICAgYnVpbGQoKTtcbiAgICAgICAgYXV0b3Jlc2l6ZShzZWxmLmlzQXV0b1Jlc2l6ZSk7XG4gICAgICAgIGVuYWJsZURyYWcoc2VsZi5pc0VuYWJsZURyYWcpO1xuICAgICAgICBlbmFibGVUb29sdGlwKHNlbGYuaXNFbmFibGVUb29sdGlwKTtcbiAgICAgICAgZW5hYmxlWm9vbShzZWxmLmlzRW5hYmxlWm9vbSk7XG4gICAgICAgIHNob3dMYW5lTGFiZWwoc2VsZi5pc0VuYWJsZVRvb2x0aXApO1xuICAgICAgICBzaG93WEdyaWQoc2VsZi5pc1Nob3dYR3JpZCk7XG4gICAgICAgIHNob3dZR3JpZChzZWxmLmlzU2hvd1lHcmlkKTtcbiAgICAgICAgcmVkcmF3KCk7XG4gICAgfSkoKTtcblxuICAgIGZ1bmN0aW9uIGFkZEl0ZW1zKG5ld0l0ZW1zKSB7XG4gICAgICAgIHZhciBpdGVtc1R5cGUgPSB0b1N0ci5jYWxsKG5ld0l0ZW1zKTtcbiAgICAgICAgaWYgKGl0ZW1zVHlwZSAhPT0gYXN0ciAmJiBpdGVtc1R5cGUgIT09IG9zdHIpIHRocm93RXJyb3IoJ0V4cGVjdGVkIG9iamVjdCBvciBhcnJheS4gR290OiAnICsgaXRlbXNUeXBlKTtcbiAgICAgICAgKGl0ZW1zVHlwZSA9PT0gYXN0cikgPyBzZWxmLml0ZW1zID0gc2VsZi5pdGVtcy5jb25jYXQobmV3SXRlbXMpIDogc2VsZi5pdGVtcy5wdXNoKG5ld0l0ZW1zKTtcbiAgICAgICAgb25JdGVtc0NoYW5nZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGF1dG9yZXNpemUoaXNBdXRvUmVzaXplKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNBdXRvUmVzaXplO1xuICAgICAgICBkMy5zZWxlY3Qod2luZG93KS5vbigncmVzaXplJywgKGlzQXV0b1Jlc2l6ZSAhPT0gZmFsc2UpID8gcmVzaXplIDogbnVsbCk7XG4gICAgICAgIHNlbGYuaXNBdXRvUmVzaXplID0gaXNBdXRvUmVzaXplO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGJ1aWxkKCkge1xuICAgICAgICB2YXIgbGFuZUxlbmd0aCA9IHNlbGYubGFuZXMubGVuZ3RoLFxuICAgICAgICAgICAgbWFyZ2luV2lkdGggPSBnZXRNYXJnaW5XaWR0aCgpLFxuICAgICAgICAgICAgbWFyZ2luSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCk7XG5cbiAgICAgICAgY2hhcnQgPSBkMy5zZWxlY3Qoc2VsZi5yZW5kZXJUbylcbiAgICAgICAgICAgIC5hcHBlbmQoXCJzdmdcIilcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgc2VsZi53aWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNlbGYuaGVpZ2h0KVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LWNoYXJ0XCIpO1xuXG4gICAgICAgIGNoYXJ0LmFwcGVuZChcImRlZnNcIikuYXBwZW5kKFwiY2xpcFBhdGhcIilcbiAgICAgICAgICAgIC5hdHRyKFwiaWRcIiwgXCJjbGlwXCIpXG4gICAgICAgICAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodCk7XG5cbiAgICAgICAgZHJhZyA9IGQzLmJlaGF2aW9yLmRyYWcoKVxuICAgICAgICAgICAgLm9uKFwiZHJhZ3N0YXJ0XCIsIGRyYWdzdGFydClcbiAgICAgICAgICAgIC5vbihcImRyYWdcIiwgZHJhZ21vdmUpXG4gICAgICAgICAgICAub24oXCJkcmFnZW5kXCIsIGRyYWdlbmQpO1xuXG4gICAgICAgIG1haW4gPSBjaGFydC5hcHBlbmQoXCJnXCIpXG4gICAgICAgICAgICAuYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKVxuICAgICAgICAgICAgLmF0dHIoXCJ3aWR0aFwiLCBtYXJnaW5XaWR0aClcbiAgICAgICAgICAgIC5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodClcbiAgICAgICAgICAgIC5hdHRyKFwiY2xhc3NcIiwgXCJtYWluXCIpO1xuXG4gICAgICAgIGl0ZW1SZWN0cyA9IG1haW4uYXBwZW5kKFwiZ1wiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGlwLXBhdGhcIiwgXCJ1cmwoI2NsaXApXCIpO1xuXG4gICAgICAgIHRvb2x0aXBEaXYgPSBkMy5zZWxlY3QoXCJib2R5XCIpLmFwcGVuZChcImRpdlwiKVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImdhbnR0LXRvb2x0aXBcIilcbiAgICAgICAgICAgIC5zdHlsZShcIm9wYWNpdHlcIiwgMCk7XG5cbiAgICAgICAgeFNjYWxlID0gZDMudGltZS5zY2FsZSgpXG4gICAgICAgICAgICAuZG9tYWluKGdldFRpbWVEb21haW4oKSlcbiAgICAgICAgICAgIC5yYW5nZShbMCwgbWFyZ2luV2lkdGhdKTtcblxuICAgICAgICB5U2NhbGUgPSBkMy5zY2FsZS5saW5lYXIoKVxuICAgICAgICAgICAgLmRvbWFpbihbMCwgbGFuZUxlbmd0aF0pXG4gICAgICAgICAgICAucmFuZ2UoWzAsIG1hcmdpbkhlaWdodF0pO1xuXG4gICAgICAgIHhBeGlzID0gZDMuc3ZnLmF4aXMoKVxuICAgICAgICAgICAgLnNjYWxlKHhTY2FsZSlcbiAgICAgICAgICAgIC5vcmllbnQoJ2JvdHRvbScpXG4gICAgICAgICAgICAudGlja3MoNSlcblxuICAgICAgICB5QXhpcyA9IGQzLnN2Zy5heGlzKClcbiAgICAgICAgICAgIC5zY2FsZSh5U2NhbGUpXG4gICAgICAgICAgICAub3JpZW50KCdsZWZ0JylcbiAgICAgICAgICAgIC50aWNrcyhsYW5lTGVuZ3RoKVxuICAgICAgICAgICAgLnRpY2tGb3JtYXQoXCJcIik7XG5cbiAgICAgICAgem9vbSA9IGQzLmJlaGF2aW9yLnpvb20oKVxuICAgICAgICAgICAgLngoeFNjYWxlKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cigndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZSgwLCcgKyBtYXJnaW5IZWlnaHQgKyAnKScpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbWFpbiBheGlzIGRhdGUnKVxuICAgICAgICAgICAgLmNhbGwoeEF4aXMpXG5cbiAgICAgICAgbWFpbi5hcHBlbmQoJ2cnKVxuICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgJ21haW4gYXhpcyBsYW5lJylcbiAgICAgICAgICAgIC5jYWxsKHlBeGlzKTtcblxuICAgICAgICBtYWluLmFwcGVuZCgnZycpXG4gICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnbGFuZUxhYmVscycpO1xuXG4gICAgICAgIGNoYXJ0LmNhbGwoem9vbSk7XG5cbiAgICAgICAgZDMuc2VsZWN0KCdodG1sJykub24oXCJjbGlja1wiLCBmdW5jdGlvbihkKSB7XG4gICAgICAgICAgICBpZiAoIXNlbGYuaXNFbmFibGVUb29sdGlwKSByZXR1cm47XG4gICAgICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCdzdmcgcmVjdCcpKSB7XG4gICAgICAgICAgICAgICAgaGlkZVRvb2x0aXAoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hhbmdlQ3Vyc29yKGQpIHtcbiAgICAgICAgdmFyIHggPSBwYXJzZUZsb2F0KGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwieFwiKSksXG4gICAgICAgICAgICB3aWR0aCA9IHBhcnNlRmxvYXQoZDMuc2VsZWN0KHRoaXMpLmF0dHIoXCJ3aWR0aFwiKSksXG4gICAgICAgICAgICB4MSA9IHggKyB3aWR0aDtcblxuICAgICAgICBpZiAoKHggKyByZXNpemVSZWN0TWFyZ2luID49IGQzLmV2ZW50LngpIHx8ICh4MSA8PSBkMy5ldmVudC54KSkge1xuICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoXCJjbGFzc1wiLCBkLmNsYXNzICsgKChzZWxmLmlzRW5hYmxlSXRlbVJlc2l6ZSkgPyBcIiBjdXJzb3ItcmVzaXplXCIgOiBcIiBjdXJzb3ItZGVmYXVsdFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cihcImNsYXNzXCIsIGQuY2xhc3MgKyAoKHNlbGYuaXNFbmFibGVEcmFnKSA/IFwiIGN1cnNvci1tb3ZlXCIgOiBcIiBjdXJzb3ItZGVmYXVsdFwiKSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmFnbW92ZSgpIHtcbiAgICAgICAgdmFyIHggPSBwYXJzZUZsb2F0KGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwieFwiKSksXG4gICAgICAgICAgICB5ID0gcGFyc2VGbG9hdChkMy5zZWxlY3QodGhpcykuYXR0cihcInlcIikpLFxuICAgICAgICAgICAgd2lkdGggPSBwYXJzZUZsb2F0KGQzLnNlbGVjdCh0aGlzKS5hdHRyKFwid2lkdGhcIikpLFxuICAgICAgICAgICAgeDEgPSB4ICsgd2lkdGg7XG5cbiAgICAgICAgaWYgKHNlbGYuaXNFbmFibGVJdGVtUmVzaXplKSB7XG4gICAgICAgICAgICBpZiAoeCArIHJlc2l6ZVJlY3RNYXJnaW4gPj0gZDMuZXZlbnQueCAmJiB4IDw9IHgxIC0gcmVzaXplUmVjdE1hcmdpbikge1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcInhcIiwgeCArIGQzLmV2ZW50LmR4KVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoIC0gZDMuZXZlbnQuZHgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh4MSAtIHJlc2l6ZVJlY3RNYXJnaW4gPD0gZDMuZXZlbnQueCAmJiB4ICsgNSA8PSB4MSkge1xuICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgICAgICAuYXR0cihcIndpZHRoXCIsIHdpZHRoICsgZDMuZXZlbnQuZHgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZi5pc0VuYWJsZURyYWcpIHtcbiAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKVxuICAgICAgICAgICAgICAgIC5hdHRyKFwieFwiLCB4ICsgZDMuZXZlbnQuZHgpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ5XCIsIHkgKyBkMy5ldmVudC5keSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmFnZW5kKGQpIHtcbiAgICAgICAgaWYgKCFzZWxmLmlzRW5hYmxlRHJhZyAmJiAhc2VsZi5pc0VuYWJsZUl0ZW1SZXNpemUpIHJldHVybjtcbiAgICAgICAgdmFyIGVsID0gZDMuc2VsZWN0KHRoaXMpLFxuICAgICAgICAgICAgbGFuZSA9IE1hdGgucm91bmQoeVNjYWxlLmludmVydChlbC5hdHRyKFwieVwiKSkpLFxuICAgICAgICAgICAgc3RhcnQgPSBlbC5hdHRyKFwieFwiKTtcblxuICAgICAgICBpZiAobGFuZSA+PSBzZWxmLmxhbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgbGFuZSA9IHNlbGYubGFuZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGFuZSA8IDApIHtcbiAgICAgICAgICAgIGxhbmUgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgZWwuYXR0cihcInlcIiwgeVNjYWxlKGxhbmUpKTtcbiAgICAgICAgZC5sYW5lID0gbGFuZTtcbiAgICAgICAgZC5zdGFydCA9IERhdGUucGFyc2UoeFNjYWxlLmludmVydChzdGFydCkpO1xuICAgICAgICBkLmVuZCA9IERhdGUucGFyc2UoeFNjYWxlLmludmVydChwYXJzZUZsb2F0KGVsLmF0dHIoXCJ3aWR0aFwiKSkgKyBwYXJzZUZsb2F0KHN0YXJ0KSkpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRyYWdzdGFydCgpIHtcbiAgICAgICAgaWYgKCFzZWxmLmlzRW5hYmxlRHJhZyAmJiAhc2VsZi5pc0VuYWJsZUl0ZW1SZXNpemUpIHJldHVybjtcbiAgICAgICAgZDMuZXZlbnQuc291cmNlRXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29weVNhbWVQcm9wKGNvcHlUbywgY29weUZyb20pIHtcbiAgICAgICAgdmFyIHA7XG5cbiAgICAgICAgZm9yIChwIGluIGNvcHlGcm9tKSB7XG4gICAgICAgICAgICBpZiAoY29weVRvLmhhc093blByb3BlcnR5KHApKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRvU3RyLmNhbGwoY29weUZyb21bcF0pID09PSBvc3RyKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlTYW1lUHJvcChjb3B5VG9bcF0sIGNvcHlGcm9tW3BdKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNvcHlUb1twXSA9IGNvcHlGcm9tW3BdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuYWJsZURyYWcoaXNFbmFibGVEcmFnKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNFbmFibGVEcmFnO1xuICAgICAgICBzZWxmLmlzRW5hYmxlRHJhZyA9IGlzRW5hYmxlRHJhZztcbiAgICAgICAgcmVkcmF3KCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZW5hYmxlSXRlbVJlc2l6ZShpc0VuYWJsZUl0ZW1SZXNpemUpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pc0VuYWJsZUl0ZW1SZXNpemU7XG4gICAgICAgIHNlbGYuaXNFbmFibGVJdGVtUmVzaXplID0gaXNFbmFibGVJdGVtUmVzaXplO1xuICAgICAgICByZWRyYXcoKTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBlbmFibGVUb29sdGlwKGlzRW5hYmxlVG9vbHRpcCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzRW5hYmxlVG9vbHRpcDtcbiAgICAgICAgc2VsZi5pc0VuYWJsZVRvb2x0aXAgPSBpc0VuYWJsZVRvb2x0aXA7XG4gICAgICAgIHJlZHJhdygpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuYWJsZVpvb20oaXNFbmFibGVab29tKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuaXNFbmFibGVab29tO1xuICAgICAgICB6b29tLm9uKFwiem9vbVwiLCAoaXNFbmFibGVab29tKSA/IHJlZHJhdyA6IG51bGwpO1xuICAgICAgICBzZWxmLmlzRW5hYmxlWm9vbSA9IGlzRW5hYmxlWm9vbTtcbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRMYW5lTGVuZ3RoKCkge1xuICAgICAgICByZXR1cm4gKGQzLm1heChzZWxmLml0ZW1zLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmxhbmUgfSkgKyAxKSB8fCAwO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldE1hcmdpbldpZHRoKCkge1xuICAgICAgICByZXR1cm4gc2VsZi53aWR0aCAtIHNlbGYubWFyZ2luLnJpZ2h0IC0gc2VsZi5tYXJnaW4ubGVmdDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRNYXJnaW5IZWlnaHQoKSB7XG4gICAgICAgIHJldHVybiBzZWxmLmhlaWdodCAtIHNlbGYubWFyZ2luLnRvcCAtIHNlbGYubWFyZ2luLmJvdHRvbTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRUaW1lRG9tYWluKCkge1xuICAgICAgICByZXR1cm4gW1xuICAgICAgICAgICAgZDMubWluKHNlbGYuaXRlbXMsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3RhcnQgfSksXG4gICAgICAgICAgICBkMy5tYXgoc2VsZi5pdGVtcywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5lbmQgfSlcbiAgICAgICAgXTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoaWRlVG9vbHRpcCgpIHtcbiAgICAgICAgdG9vbHRpcERpdi50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbig1MDApXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIDApXG4gICAgICAgICAgICAuc3R5bGUoXCJkaXNwbGF5XCIsIFwibm9uZVwiKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpdGVtcyhuZXdJdGVtcykge1xuICAgICAgICB2YXIgaXRlbXNUeXBlID0gdG9TdHIuY2FsbChuZXdJdGVtcyk7XG5cbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pdGVtcztcbiAgICAgICAgaWYgKGl0ZW1zVHlwZSAhPT0gYXN0cikgdGhyb3dFcnJvcignRXhwZWN0ZWQgYXJyYXkuIEdvdDogJyArIGl0ZW1zVHlwZSk7XG4gICAgICAgIHNlbGYuaXRlbXMgPSBuZXdJdGVtcztcblxuICAgICAgICBvbkl0ZW1zQ2hhbmdlKCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbGFuZXMobmV3TGFuZXMpIHtcbiAgICAgICAgdmFyIGxhbmVzVHlwZSA9IHRvU3RyLmNhbGwobmV3TGFuZXMpO1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmxhbmVzO1xuICAgICAgICBpZiAobGFuZXNUeXBlICE9PSBhc3RyKSB0aHJvd0Vycm9yKCdFeHBlY3RlZCBhcnJheS4gR290OiAnICsgbGFuZXNUeXBlKTtcbiAgICAgICAgc2VsZi5sYW5lcyA9IG5ld0xhbmVzO1xuICAgICAgICBzZWxmLmxhbmVzLmxlbmd0aCA9IGdldExhbmVMZW5ndGgoKSB8fCBzZWxmLmxhbmVzLmxlbmd0aDtcbiAgICAgICAgc2hvd0xhbmVMYWJlbCghc2VsZi5pc1Nob3dMYW5lTGFiZWwpO1xuICAgICAgICBzaG93TGFuZUxhYmVsKCFzZWxmLmlzU2hvd0xhbmVMYWJlbCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFyZ2luKG5ld01hcmdpbikge1xuICAgICAgICB2YXIgbXNnID0gXCIgbWFyZ2luIHZhbHVlIGlzIGluY29ycmVjdC4gQWxsIHZhbHVlcyBzaG91bGQgYmUgbnVtYmVyc1wiO1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLm1hcmdpbjtcbiAgICAgICAgaWYgKG5ld01hcmdpbi50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgaWYgKGlzTmFOKG5ld01hcmdpbi50b3ApKSB0aHJvd0Vycm9yKFwiJ1RvcCdcIiArIG1zZyk7XG4gICAgICAgICAgICBzZWxmLm1hcmdpbi50b3AgPSBwYXJzZUludChuZXdNYXJnaW4udG9wKTtcbiAgICAgICAgICAgIG1haW4uYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFyZ2luLnJpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmIChpc05hTihuZXdNYXJnaW4ucmlnaHQpKSB0aHJvd0Vycm9yKFwiJ1JpZ2h0J1wiICsgbXNnKTtcbiAgICAgICAgICAgIHNlbGYubWFyZ2luLnJpZ2h0ID0gcGFyc2VJbnQobmV3TWFyZ2luLnJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmV3TWFyZ2luLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3TWFyZ2luLmJvdHRvbSkpIHRocm93RXJyb3IoXCInQm90dG9tJ1wiICsgbXNnKTtcbiAgICAgICAgICAgIHNlbGYubWFyZ2luLmJvdHRvbSA9IHBhcnNlSW50KG5ld01hcmdpbi5ib3R0b20pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdNYXJnaW4ubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obmV3TWFyZ2luLmxlZnQpKSB0aHJvd0Vycm9yKFwiJ0xlZnQnXCIgKyBtc2cpO1xuICAgICAgICAgICAgc2VsZi5tYXJnaW4ubGVmdCA9IHBhcnNlSW50KG5ld01hcmdpbi5sZWZ0KTtcbiAgICAgICAgICAgIG1haW4uYXR0cihcInRyYW5zZm9ybVwiLCBcInRyYW5zbGF0ZShcIiArIHNlbGYubWFyZ2luLmxlZnQgKyBcIixcIiArIHNlbGYubWFyZ2luLnRvcCArIFwiKVwiKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc2l6ZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIG9uSXRlbXNDaGFuZ2UoKSB7XG4gICAgICAgIHZhciBsYW5lTGVuZ3RoID0gZ2V0TGFuZUxlbmd0aCgpO1xuICAgICAgICBzZWxmLmxhbmVzLmxlbmd0aCA9IGxhbmVMZW5ndGg7XG4gICAgICAgIHhTY2FsZS5kb21haW4oZ2V0VGltZURvbWFpbigpKTtcbiAgICAgICAgeUF4aXMudGlja3MobGFuZUxlbmd0aCk7XG4gICAgICAgIHlTY2FsZS5kb21haW4oWzAsIGxhbmVMZW5ndGhdKTtcbiAgICAgICAgem9vbS54KHhTY2FsZSk7XG4gICAgICAgIHJlZHJhdygpO1xuICAgICAgICByZWRyYXcoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWRyYXcoKSB7XG4gICAgICAgIHZhciBpdGVtSGVpZ2h0ID0gZ2V0TWFyZ2luSGVpZ2h0KCkgLyAoc2VsZi5sYW5lcy5sZW5ndGggfHwgMSkgLyAoc2VsZi5zdWJsYW5lcyB8fCAxKSxcbiAgICAgICAgICAgIHJlY3RzO1xuXG4gICAgICAgIHJlY3RzID0gaXRlbVJlY3RzLnNlbGVjdEFsbChcInJlY3RcIilcbiAgICAgICAgICAgIC5kYXRhKHNlbGYuaXRlbXMpXG4gICAgICAgICAgICAuYXR0cihcInhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLnN0YXJ0KTsgfSlcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbiAoZCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAoc2VsZi5zdWJsYW5lcyA8IDIpID8geVNjYWxlKGQubGFuZSkgOiB5U2NhbGUoZC5sYW5lKSArIGQuc3VibGFuZSppdGVtSGVpZ2h0O1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5hdHRyKFwid2lkdGhcIiwgZnVuY3Rpb24gKGQpIHsgcmV0dXJuIHhTY2FsZShkLmVuZCkgLSB4U2NhbGUoZC5zdGFydCk7IH0pXG4gICAgICAgICAgICAuYXR0cihcImhlaWdodFwiLCBpdGVtSGVpZ2h0KVxuICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gZC5jbGFzcyArICcgbWFpbic7IH0pXG4gICAgICAgICAgICAuYXR0cihcIm9wYWNpdHlcIiwgLjc1KVxuICAgICAgICAgICAgLmNhbGwoZHJhZylcbiAgICAgICAgICAgIC5vbihcImNsaWNrXCIsIChzZWxmLmlzRW5hYmxlVG9vbHRpcCkgPyBzaG93VG9vbHRpcCA6IG51bGwpXG4gICAgICAgICAgICAub24oXCJtb3VzZW1vdmVcIiwgY2hhbmdlQ3Vyc29yKVxuXG4gICAgICAgIHJlY3RzLmVudGVyKCkuYXBwZW5kKFwicmVjdFwiKTtcbiAgICAgICAgcmVjdHMuZXhpdCgpLnJlbW92ZSgpO1xuXG4gICAgICAgIG1haW4uc2VsZWN0KCdnLm1haW4uYXhpcy5kYXRlJykuY2FsbCh4QXhpcyk7XG4gICAgICAgIG1haW4uc2VsZWN0KCdnLm1haW4uYXhpcy5sYW5lJykuY2FsbCh5QXhpcyk7XG5cbiAgICAgICAgaGlkZVRvb2x0aXAoKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZXNpemUoKSB7XG4gICAgICAgIGlmIChzZWxmLmlzQXV0b1Jlc2l6ZSkge1xuICAgICAgICAgICAgc2VsZi53aWR0aCA9IHBhcnNlSW50KGQzLnNlbGVjdChzZWxmLnJlbmRlclRvKS5zdHlsZSgnd2lkdGgnKSk7XG4gICAgICAgICAgICBzZWxmLmhlaWdodCA9IHBhcnNlSW50KGQzLnNlbGVjdChzZWxmLnJlbmRlclRvKS5zdHlsZSgnaGVpZ2h0JykpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXJnaW5XaWR0aCA9IGdldE1hcmdpbldpZHRoKCksXG4gICAgICAgICAgICBtYXJnaW5IZWlnaHQgPSBnZXRNYXJnaW5IZWlnaHQoKTtcblxuICAgICAgICB4U2NhbGUucmFuZ2UoWzAsIG1hcmdpbldpZHRoXSk7XG4gICAgICAgIHlTY2FsZS5yYW5nZShbMCwgbWFyZ2luSGVpZ2h0XSk7XG4gICAgICAgIGNoYXJ0LmF0dHIoXCJ3aWR0aFwiLCBzZWxmLndpZHRoKTtcbiAgICAgICAgY2hhcnQuYXR0cihcImhlaWdodFwiLCBzZWxmLmhlaWdodCk7XG4gICAgICAgIGNoYXJ0LnNlbGVjdCgnZGVmcycpLnNlbGVjdCgnY2xpcFBhdGgnKS5zZWxlY3QoJ3JlY3QnKS5hdHRyKFwid2lkdGhcIiwgbWFyZ2luV2lkdGgpO1xuICAgICAgICBjaGFydC5zZWxlY3QoJ2RlZnMnKS5zZWxlY3QoJ2NsaXBQYXRoJykuc2VsZWN0KCdyZWN0JykuYXR0cihcImhlaWdodFwiLCBtYXJnaW5XaWR0aCk7XG4gICAgICAgIG1haW4uYXR0cihcIndpZHRoXCIsIG1hcmdpbldpZHRoKTtcbiAgICAgICAgbWFpbi5hdHRyKFwiaGVpZ2h0XCIsIG1hcmdpbkhlaWdodCk7XG5cbiAgICAgICAgbWFpbi5zZWxlY3QoJ2cubWFpbi5heGlzLmRhdGUnKVxuICAgICAgICAgICAgLmF0dHIoJ3RyYW5zZm9ybScsICd0cmFuc2xhdGUoMCwnICsgZ2V0TWFyZ2luSGVpZ2h0KCkgKyAnKScpO1xuXG4gICAgICAgIG1haW4uc2VsZWN0KCdnLmxhbmVMYWJlbHMnKVxuICAgICAgICAgICAgLnNlbGVjdEFsbChcIi5sYW5lVGV4dFwiKVxuICAgICAgICAgICAgLmRhdGEoc2VsZi5sYW5lcylcbiAgICAgICAgICAgIC5hdHRyKFwieVwiLCBmdW5jdGlvbihkLCBpKSB7cmV0dXJuIHlTY2FsZShpICsgLjUpO30pXG5cbiAgICAgICAgem9vbS54KHhTY2FsZSk7XG5cbiAgICAgICAgc2hvd1hHcmlkKHNlbGYuaXNTaG93WUdyaWQpO1xuICAgICAgICBzaG93WUdyaWQoc2VsZi5pc1Nob3dZR3JpZCk7XG5cbiAgICAgICAgcmVkcmF3KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2hvd0xhbmVMYWJlbChpc1Nob3dMYW5lTGFiZWwpIHtcbiAgICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gc2VsZi5pc1Nob3dMYW5lTGFiZWw7XG4gICAgICAgIHNlbGYuaXNTaG93TGFuZUxhYmVsID0gaXNTaG93TGFuZUxhYmVsO1xuICAgICAgICBpZiAoaXNTaG93TGFuZUxhYmVsID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbWFpbi5zZWxlY3RBbGwoXCIubGFuZVRleHRcIikucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBtYWluLnNlbGVjdCgnZy5sYW5lTGFiZWxzJykuc2VsZWN0QWxsKFwiLmxhbmVUZXh0XCIpXG4gICAgICAgICAgICAgICAgLmRhdGEoc2VsZi5sYW5lcylcbiAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkge3JldHVybiBkO30pXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ4XCIsIC1zZWxmLm1hcmdpbi5yaWdodClcbiAgICAgICAgICAgICAgICAuYXR0cihcInlcIiwgZnVuY3Rpb24oZCwgaSkge3JldHVybiB5U2NhbGUoaSArIC41KTt9KVxuICAgICAgICAgICAgICAgIC5hdHRyKFwiZHlcIiwgXCIuNWV4XCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcInN0YXJ0XCIpXG4gICAgICAgICAgICAgICAgLmF0dHIoXCJjbGFzc1wiLCBcImxhbmVUZXh0XCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGFwaTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzaG93VG9vbHRpcChkKSB7XG4gICAgICAgIGlmIChkMy5ldmVudC5kZWZhdWx0UHJldmVudGVkKSByZXR1cm47XG4gICAgICAgIHRvb2x0aXBEaXYuc3R5bGUoXCJkaXNwbGF5XCIsIFwiYmxvY2tcIilcbiAgICAgICAgICAgIC50cmFuc2l0aW9uKClcbiAgICAgICAgICAgIC5kdXJhdGlvbigyMDApXG4gICAgICAgICAgICAuc3R5bGUoXCJvcGFjaXR5XCIsIC45KTtcbiAgICAgICAgdG9vbHRpcERpdi5odG1sKCh0eXBlb2YgZC50b29sdGlwID09PSAnZnVuY3Rpb24nKSA/IGQudG9vbHRpcCgpIDogZC50b29sdGlwKVxuICAgICAgICAgICAgLnN0eWxlKFwibGVmdFwiLCAoZDMuZXZlbnQucGFnZVgpICsgXCJweFwiKVxuICAgICAgICAgICAgLnN0eWxlKFwidG9wXCIsIChkMy5ldmVudC5wYWdlWSkgKyBcInB4XCIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dYR3JpZChpc1Nob3dYR3JpZCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzU2hvd1hHcmlkO1xuICAgICAgICB2YXIgaGVpZ2h0ID0gKGlzU2hvd1hHcmlkICE9PSBmYWxzZSkgPyAtZ2V0TWFyZ2luSGVpZ2h0KCkgOiAtNjtcbiAgICAgICAgeEF4aXMudGlja1NpemUoaGVpZ2h0LCAwLCAwKTtcbiAgICAgICAgc2VsZi5pc1Nob3dYR3JpZCA9IGlzU2hvd1hHcmlkO1xuICAgICAgICBtYWluLnNlbGVjdCgnZy5tYWluLmF4aXMuZGF0ZScpLmNhbGwoeEF4aXMpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNob3dZR3JpZChpc1Nob3dZR3JpZCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBzZWxmLmlzU2hvd1lHcmlkO1xuICAgICAgICB2YXIgd2lkdGggPSAoaXNTaG93WUdyaWQgIT09IGZhbHNlKSA/IC1nZXRNYXJnaW5XaWR0aCgpIDogLTY7XG4gICAgICAgIHlBeGlzLnRpY2tTaXplKHdpZHRoLCAwLCAwKTtcbiAgICAgICAgc2VsZi5pc1Nob3dZR3JpZCA9IGlzU2hvd1lHcmlkO1xuICAgICAgICBtYWluLnNlbGVjdCgnZy5tYWluLmF4aXMubGFuZScpLmNhbGwoeUF4aXMpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNpemUod2lkdGgsIGhlaWdodCkge1xuICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBbc2VsZi53aWR0aCwgc2VsZi5oZWlnaHRdO1xuICAgICAgICBzZWxmLndpZHRoID0gcGFyc2VJbnQod2lkdGgpIHx8IHNlbGYud2lkdGg7XG4gICAgICAgIHNlbGYuaGVpZ2h0ID0gcGFyc2VJbnQoaGVpZ2h0KSB8fCBzZWxmLmhlaWdodDtcbiAgICAgICAgYXV0b3Jlc2l6ZShmYWxzZSk7XG4gICAgICAgIHJlc2l6ZSgpO1xuICAgICAgICByZXR1cm4gYXBpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN1YmxhbmVzKG5ld1N1YmxhbmVzKSB7XG4gICAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIHNlbGYuc3VibGFuZXM7XG4gICAgICAgIHNlbGYuc3VibGFuZXMgPSBuZXdTdWJsYW5lcztcbiAgICAgICAgcmVkcmF3KCk7XG4gICAgICAgIHJldHVybiBhcGk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdGhyb3dFcnJvcihtc2cpIHtcbiAgICAgICAgdGhyb3cgVHlwZUVycm9yKG1zZyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFwaTtcbn1cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
